webpackJsonp([1],{"/aKM":function(e,t){},0:function(e,t){},"4+hh":function(e,t){},"A+BG":function(e,t){},L66j:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("7+uW"),i=n("/ocq"),a={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("md-app-toolbar",{staticClass:"md-primary"},[n("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[n("navbar")],1)]),e._v(" "),n("div",{staticClass:"md-toolbar-row md-layout md-alignment-center-center"},[n("div",{staticClass:"banner-container"},[n("img",{attrs:{src:"static/img/perspective-hr.jpg",alt:"banner"}}),e._v(" "),n("div",{staticClass:"subtitle"},[e._v("Image processing with joy."),n("br"),e._v(" "),n("md-button",{staticClass:"md-raised md-accent",on:{click:function(t){e.showDialog=!0}}},[e._v("Getting Started")])],1)])]),e._v(" "),n("br"),e._v(" "),n("md-dialog",{attrs:{"md-active":e.showDialog},on:{"update:mdActive":function(t){e.showDialog=t}}},[n("md-dialog-title",[e._v("Getting Started with ImJoy")]),e._v(" "),n("md-dialog-content",[n("p",[e._v("With the ImJoy web app, you process your images within the browser, instantly, no installation.")]),e._v(" "),n("md-button",{staticClass:"md-raised md-primary",attrs:{to:"app"}},[e._v("Start")]),e._v(" "),n("p",[e._v("You can process your data with the Imjoy app locally and anonymously, by default, no data will be transferred to the internet (also depends on the plugin you installed).")])],1),e._v(" "),n("md-dialog-actions",[n("md-button",{staticClass:"md-primary",on:{click:function(t){e.showDialog=!1}}},[e._v("OK")])],1)],1),e._v(" "),n("br"),e._v(" "),n("plugin-list",{attrs:{"config-url":"https://raw.githubusercontent.com/oeway/ImJoy-Plugins/master/manifest.json",title:"Plugins"}}),e._v(" "),n("br"),e._v(" "),n("md-divider"),e._v(" "),n("main-footer")],1)},staticRenderFns:[]};var r=n("VU/8")({name:"home",data:function(){return{showDialog:!1,router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){this.$nextTick(function(){})},methods:{}},a,!1,function(e){n("yYM+")},"data-v-6deb61f7",null).exports,s=n("pFYg"),l=n.n(s),c=n("fZjL"),d=n.n(c),u=n("d7EF"),p=n.n(u),m=n("BO1k"),h=n.n(m),f=n("mvHQ"),v=n.n(f),g=n("Xxa5"),w=n.n(g),_=n("exGp"),y=n.n(_),b=n("//Fk"),k=n.n(b),C=n("mtWM"),x=n.n(C),j=n("kkYf"),P=n.n(j),E=P()({_id:[null,String],name:String,url:[null,String],code:String,lang:[null,String],script:[null,String],style:[null,String],window:[null,String]}),D=P()({name:String,type:String,mode:String,tags:Array,ui:[null,String],inputs:[null,Object],outputs:[null,Object]}),S=P()({name:String,type:String,config:Object,data:[null,Object],panel:[null,Object],force_show:Boolean});String,String,String,Array,String,Object,Object;function O(){return Math.random().toString(36).substr(2,10)}var I=n("OvRC"),$=n.n(I),W=n("u2KI"),A=/\r?\n/g,T=/^\s*$/,R=/^(\r?\n)*[\t\s]/,L=function(e){if(!R.test(e))return e;for(var t,n,o,i=e.split(A),a=1/0,r=0;r<i.length;r++){var s=i[r];if(!T.test(s))if(t)(n=N(s,t))<a&&(a=n);else{if(" "!==(o=s.charAt(0))&&"\t"!==o)return e;(n=N(s,t=o))<a&&(a=n)}}return i.map(function(e){return e.slice(a)}).join("\n")};function N(e,t){for(var n=0;e.charAt(n)===t;)n++;return n}n.n(W)()({});Object.prototype.toString;function M(e,t){for(var n=$()(null),o=e.split(","),i=0;i<o.length;i++)n[o[i]]=!0;return t?function(e){return n[e.toLowerCase()]}:function(e){return n[e]}}M("slot,component",!0),M("key,ref,slot,slot-scope,is");Object.prototype.hasOwnProperty;var U,B,F=/-(\w)/g;U=function(e){return e.replace(F,function(e,t){return t?t.toUpperCase():""})},B=$()(null);Function.prototype.bind;var z=function(e,t,n){return!1};M("area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr"),M("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr,source");var J=M("address,article,aside,base,blockquote,body,caption,col,colgroup,dd,details,dialog,div,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,legend,li,menuitem,meta,optgroup,option,param,rp,rt,source,style,summary,tbody,td,tfoot,th,thead,title,tr,track"),V=/^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,q="[a-zA-Z_][\\w\\-\\.]*",H="((?:"+q+"\\:)?"+q+")",X=new RegExp("^<"+H),G=/^\s*(\/?)>/,Y=new RegExp("^<\\/"+H+"[^>]*>"),K=/^<!DOCTYPE [^>]+>/i,Q=/^<!\--/,Z=/^<!\[/,ee=!1;"x".replace(/x(.)?/g,function(e,t){ee=""===t});var te=M("script,style,textarea",!0),ne={},oe={"&lt;":"<","&gt;":">","&quot;":'"',"&amp;":"&","&#10;":"\n","&#9;":"\t"},ie=/&(?:lt|gt|quot|amp);/g,ae=/&(?:lt|gt|quot|amp|#10|#9);/g,re=M("pre,textarea",!0),se=function(e,t){return e&&re(e)&&"\n"===t[0]};function le(e,t){var n=t?ae:ie;return e.replace(n,function(e){return oe[e]})}var ce=/\r?\n/g,de=/./g,ue=M("script,style,template",!0);function pe(e,t){void 0===t&&(t={});var n={template:null,script:null,styles:[],customBlocks:[]},o=0,i=null;return function(e,t){for(var n,o,i=[],a=t.expectHTML,r=t.isUnaryTag||z,s=t.canBeLeftOpenTag||z,l=0;e;){if(n=e,o&&te(o)){var c=0,d=o.toLowerCase(),u=ne[d]||(ne[d]=new RegExp("([\\s\\S]*?)(</"+d+"[^>]*>)","i")),p=e.replace(u,function(e,n,o){return c=o.length,te(d)||"noscript"===d||(n=n.replace(/<!\--([\s\S]*?)-->/g,"$1").replace(/<!\[CDATA\[([\s\S]*?)]]>/g,"$1")),se(d,n)&&(n=n.slice(1)),t.chars&&t.chars(n),""});l+=e.length-p.length,e=p,P(d,l-c,l)}else{var m=e.indexOf("<");if(0===m){if(Q.test(e)){var h=e.indexOf("--\x3e");if(h>=0){t.shouldKeepComment&&t.comment(e.substring(4,h)),C(h+3);continue}}if(Z.test(e)){var f=e.indexOf("]>");if(f>=0){C(f+2);continue}}var v=e.match(K);if(v){C(v[0].length);continue}var g=e.match(Y);if(g){var w=l;C(g[0].length),P(g[1],w,l);continue}var _=x();if(_){j(_),se(o,e)&&C(1);continue}}var y=void 0,b=void 0,k=void 0;if(m>=0){for(b=e.slice(m);!(Y.test(b)||X.test(b)||Q.test(b)||Z.test(b)||(k=b.indexOf("<",1))<0);)m+=k,b=e.slice(m);y=e.substring(0,m),C(m)}m<0&&(y=e,e=""),t.chars&&y&&t.chars(y)}if(e===n){t.chars&&t.chars(e),!i.length&&t.warn&&t.warn('Mal-formatted tag at end of template: "'+e+'"');break}}function C(t){l+=t,e=e.substring(t)}function x(){var t=e.match(X);if(t){var n,o,i={tagName:t[1],attrs:[],start:l};for(C(t[0].length);!(n=e.match(G))&&(o=e.match(V));)C(o[0].length),i.attrs.push(o);if(n)return i.unarySlash=n[1],C(n[0].length),i.end=l,i}}function j(e){var n=e.tagName,l=e.unarySlash;a&&("p"===o&&J(n)&&P(o),s(n)&&o===n&&P(n));for(var c=r(n)||!!l,d=e.attrs.length,u=new Array(d),p=0;p<d;p++){var m=e.attrs[p];ee&&-1===m[0].indexOf('""')&&(""===m[3]&&delete m[3],""===m[4]&&delete m[4],""===m[5]&&delete m[5]);var h=m[3]||m[4]||m[5]||"",f="a"===n&&"href"===m[1]?t.shouldDecodeNewlinesForHref:t.shouldDecodeNewlines;u[p]={name:m[1],value:le(h,f)}}c||(i.push({tag:n,lowerCasedTag:n.toLowerCase(),attrs:u}),o=n),t.start&&t.start(n,u,c,e.start,e.end)}function P(e,n,a){var r,s;if(null==n&&(n=l),null==a&&(a=l),e&&(s=e.toLowerCase()),e)for(r=i.length-1;r>=0&&i[r].lowerCasedTag!==s;r--);else r=0;if(r>=0){for(var c=i.length-1;c>=r;c--)(c>r||!e)&&t.warn&&t.warn("tag <"+i[c].tag+"> has no matching end tag."),t.end&&t.end(i[c].tag,n,a);i.length=r,o=r&&i[r-1].tag}else"br"===s?t.start&&t.start(e,[],!0,n,a):"p"===s&&(t.start&&t.start(e,[],!1,n,a),t.end&&t.end(e,n,a))}P()}(e,{start:function(e,t,a,r,s){0===o&&(i={type:e,content:"",start:s,attrs:t.reduce(function(e,t){var n=t.name,o=t.value;return e[n]=o||!0,e},{})},ue(e)?(function(e,t){for(var n=0;n<t.length;n++){var o=t[n];"lang"===o.name&&(e.lang=o.value),"scoped"===o.name&&(e.scoped=!0),"module"===o.name&&(e.module=o.value||!0),"src"===o.name&&(e.src=o.value)}}(i,t),"style"===e?n.styles.push(i):n[e]=i):n.customBlocks.push(i)),a||o++},end:function(n,a,r){if(1===o&&i){i.end=a;var s=L(e.slice(i.start,i.end));"template"!==i.type&&t.pad&&(s=function(t,n){if("space"===n)return e.slice(0,t.start).replace(de," ");var o=e.slice(0,t.start).split(ce).length,i="script"!==t.type||t.lang?"\n":"//\n";return Array(o).join(i)}(i,t.pad)+s),i.content=s,i=null}o--}}),n}var me=n("DmT9"),he=n.n(me),fe=n("M4fF"),ve=n.n(fe),ge=n("vTna"),we={name:"imjoy",props:["title"],data:function(){return{client_id:null,file_select:null,folder_select:null,selected_file:null,selected_files:null,showPluginDialog:!1,showSettingsDialog:!1,showAddPluginDialog:!1,plugin_dialog_config:null,_plugin_dialog_promise:{},loading:!1,progress:0,status_text:"",engine_status:"disconnected",engine_connected:!1,engine_url:"http://localhost:8080",windows:[],active_windows:[],selected_workspace:null,connection_token:null,showTokenPrompt:!1,showPluginEngineInfo:!1,workspace_list:[],workflow_list:[],resumable_plugins:[],showNewWorkspaceDialog:!1,new_workspace_name:"default",preload_main:["/static/tfjs/tfjs.js","https://rawgit.com/nicolaspanel/numjs/893016ec40e62eaaa126e1024dbe250aafb3014b/dist/numjs.min.js"],workflow_joy_config:{expanded:!0,name:"Workflow",ui:"{id:'workflow', type:'ops'}"},default_window_pos:{i:0,x:0,y:0,w:5,h:5},plugins:{},plugin_names:{},registered:{ops:{},windows:{},extensions:{}},plugin_templates:{"Webworker(Javascript)":'\n<docs>\nDescribe your plugin here.\n</docs>\n\n<config>\n{\n  "name": "Untitled Plugin",\n  "mode": "webworker",\n  "tags": ["op", "image"],\n  "ui": "image processing",\n  "version": "0.1.0",\n  "api_version": "0.1.0",\n  "description": "A plugin for image processing.",\n  "icon": "extension",\n  "inputs": null,\n  "outputs": null,\n  "dependencies": []\n}\n</config>\n\n<script lang="javascript">\nclass UntitledPlugin {\n  async setup() {\n    //await importScripts("http://xxxx/xxx.js")\n  }\n\n  run(my) {\n    console.log(\'running in the plugin \', my)\n\n  }\n}\n\napi.export(new UntitledPlugin())\n<\/script>\n\n',"Iframe(Javascript and HTML)":'\n<docs>\nDescribe your plugin here.\n</docs>\n\n<config>\n{\n  "name": "Untitled Plugin",\n  "mode": "iframe",\n  "tags": ["op", "window"],\n  "ui": "image display with iframe",\n  "version": "0.1.0",\n  "api_version": "0.1.0",\n  "description": "A plugin for image display.",\n  "icon": "extension",\n  "inputs": null,\n  "outputs": null,\n  "dependencies": []\n}\n</config>\n\n<script lang="javascript">\nclass UntitledPlugin {\n  async setup() {\n    //await importScripts("http://xxxx/xxx.js")\n  }\n\n  run(my) {\n    console.log(\'running in the plugin \', my)\n\n  }\n}\n\napi.export(new UntitledPlugin())\n<\/script>\n\n',"PyWorker(Python)":'\n<docs>\nDescribe your plugin here.\n</docs>\n\n<config>\n{\n  "name": "Untitled Plugin",\n  "mode": "pyworker",\n  "version": "0.1.0",\n  "api_version": "0.1.1",\n  "createdAt": "Mon Jun 26 2018 15:45:30",\n  "description": "A plugin for demonstrate python plugin.",\n  "tags": ["demo", "op"],\n  "ui": "image processing with python",\n  "inputs": null,\n  "outputs": null,\n  "icon": null,\n  "env": null,\n  "requirements": [],\n  "cmd": "python",\n  "dependencies": []\n}\n</config>\n\n<script lang="python">\nimport numpy as np\nclass PythonPlugin():\n  def setup(self):\n    print(\'setup in python\')\n\n  def run(self, my):\n    print(\'hello world.\')\n    return my\n\napi.export(PythonPlugin())\n<\/script>\n\n'},updating_workflow:!1,installed_plugins:[],plugin_api:null,plugin_context:null,plugin_loaded:!1,menuVisible:!0,snackbar_info:"",snackbar_duration:3e3,show_snackbar:!1,db:null,store:this.$root.$data.store,api:this.$root.$data.store.api}},watch:{menuVisible:function(){}},created:function(){var e=this;window.onbeforeunload=function(e){return modified?"":null},window.addEventListener("dragover",function(e){e.preventDefault(),document.querySelector("#dropzone").style.visibility="",document.querySelector("#dropzone").style.opacity=1,document.querySelector("#textnode").style.fontSize="48px"}),window.addEventListener("dragenter",function(e){e.preventDefault(),document.querySelector("#dropzone").style.visibility="",document.querySelector("#dropzone").style.opacity=1,document.querySelector("#textnode").style.fontSize="48px"}),window.addEventListener("dragleave",function(e){e.preventDefault(),document.querySelector("#dropzone").style.visibility="hidden",document.querySelector("#dropzone").style.opacity=0,document.querySelector("#textnode").style.fontSize="42px"}),window.addEventListener("drop",function(t){t.preventDefault(),document.querySelector("#dropzone").style.visibility="hidden",document.querySelector("#dropzone").style.opacity=0,document.querySelector("#textnode").style.fontSize="42px",e.selected_files=t.dataTransfer.files,e.loadFiles()}),this.importScripts.apply(null,this.preload_main).then(function(){console.log("preload done.")})},beforeRouteLeave:function(e,t,n){this.windows&&this.windows.length>0?window.confirm("Do you really want to leave? you have unsaved changes!")?n():n(!1):n()},mounted:function(){var e=this;this.client_id=localStorage.getItem("imjoy_client_id"),this.client_id||(this.client_id="imjoy_web_"+O(),localStorage.setItem("imjoy_client_id",this.client_id)),this.connection_token=localStorage.getItem("imjoy_connection_token"),this.plugin_api={alert:alert,register:this.register,createWindow:this.createWindow,showDialog:this.showDialog,showProgress:this.showProgress,showStatus:this.showStatus,run:this.runPlugin},this.pluing_context={},this.plugin_loaded=!1,this.loading=!0,this.config_db=new PouchDB("imjoy_config",{revs_limit:2,auto_compaction:!0});var t=null;console.log("loading workspace: ",this.$route.query.w),this.config_db.get("workspace_list").then(function(n){e.workspace_list=n.list,t=n.default}).catch(function(n){console.error(n),e.config_db.put({_id:"workspace_list",list:["default"],default:"default"}),e.workspace_list=["default"],t="default"}).then(function(){e.selected_workspace=e.$route.query.w||t,e.workspace_list.includes(e.selected_workspace)&&e.selected_workspace==t||(e.workspace_list.includes(e.selected_workspace)||e.workspace_list.push(e.selected_workspace),e.config_db.get("workspace_list").then(function(t){e.config_db.put({_id:t._id,_rev:t._rev,list:e.workspace_list,default:"default"})})),"default"!=e.selected_workspace&&e.$router.replace({query:{w:e.selected_workspace}}),e.db=new PouchDB(e.selected_workspace+"_workspace",{revs_limit:2,auto_compaction:!0}),e.connectEngine(e.engine_url,!0)}).then(function(){e.reloadPlugins()})},beforeDestroy:function(){for(var e in console.log("terminating plugins"),this.plugins)if(this.plugins.hasOwnProperty(e)){var t=this.plugins[e];try{"function"==typeof t.terminate&&t.terminate()}catch(e){}}this.plugins=null,this.plugin_names=null,this.disconnectEngine()},methods:{sortedPlugins:function(){return ve.a.orderBy(this.plugins,"name")},registerExtension:function(e,t){for(var n=0;n<e.length;n++)e[n]=e[n].replace(".",""),this.registered.extensions[e[n]]?this.registered.extensions[e[n]].push(t):this.registered.extensions[e[n]]=[t]},switchWorkspace:function(e){console.log("switch to ",e);var t={w:e};"default"==e&&(t=null),this.$router.push({name:"app",query:t}),this.$router.go()},show:function(e,t){this.snackbar_info=e,this.snackbar_duration=t||3e3,this.show_snackbar=!0},connectEngine:function(e,t){var n=this;this.socket&&this.socket.disconnect(),this.engine_status="Connecting, please wait...";var o=he()(e),i=setTimeout(function(){o&&(o.disconnect(),n.engine_status="Plugin Engine not connected",t||n.show("Error: connection timeout, please make sure you have started the plugin engine.",5e3),t||(n.showPluginEngineInfo=!0))},3e3);o.on("connect",function(e){clearTimeout(i),o.emit("register_client",{id:n.client_id,token:n.connection_token},function(t){t.success?(n.resumable_plugins=[],n.socket=o,n.pluing_context.socket=o,n.engine_connected=!0,n.engine_status="Plugin Engine connected.",localStorage.setItem("imjoy_connection_token",n.connection_token),console.log("these python plugins can be resumed: ",t.plugins),n.show("Plugin Engine connected."),console.log("plugin engine connected."),n.store.event_bus.$emit("engine_connected",e),n.reloadPythonPlugins()):(o.disconnect(),n.showTokenPrompt=!0,console.error("failed to connect."))})}),o.on("disconnect",function(){console.log("plugin engine disconnected."),n.engine_connected=!1,n.show("Plugin Engine disconnected."),n.engine_status="Plugin Engine disconnected.",n.socket=null,n.pluing_context.socket=null,n.removePythonPlugins()}),this.socket=o},disconnectEngine:function(){this.socket&&this.socket.disconnect()},importScript:function(e){return new k.a(function(t,n){var o=document.createElement("script");o.src=e,o.onload=t,o.onreadystatechange=t,o.onerror=n,document.head.appendChild(o)})},importScripts:function(){var e=arguments,t=this;return y()(w.a.mark(function n(){var o,i,a;return w.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=Array.prototype.slice.call(e),i=o.length,a=0;case 1:if(!(a<i)){n.next=7;break}return n.next=4,t.importScript(o[a]);case 4:a++,n.next=1;break;case 7:case"end":return n.stop()}},n,t)}))()},editPlugin:function(e){var t=this.plugins[e],n=t.config,o={name:n.name,type:"imjoy/plugin-editor",config:{},plugin:t,reload:this.reloadPlugin,save:this.savePlugin,w:10,h:10,data:{name:n.name,id:t.id,code:n.code}};this.addWindow(o)},newPlugin:function(e){var t={name:"New Plugin",type:"imjoy/plugin-editor",config:{},reload:this.reloadPlugin,save:this.savePlugin,w:10,h:10,plugin:{},data:{name:"new plugin",id:"plugin_"+O(),code:JSON.parse(v()(e))}};this.addWindow(t)},resumePlugin:function(e){},reloadPlugin:function(e){var t=this;return new k.a(function(n,o){if(e.type||e.name)for(var i in t.plugins)if(t.plugins.hasOwnProperty(i)){var a=t.plugins[i];if(a.type==e.type||a.name==e.name)try{delete t.plugins[i],delete t.plugin_names[e.name],ge.a.remove(e.type),console.log("terminating ",a),"function"==typeof a.terminate&&a.terminate()}catch(e){}}if(e.plugin&&e.plugin.id&&t.plugins[e.plugin.id]&&(delete t.plugin_names[t.plugins[e.plugin.id].name],delete t.plugins[e.plugin.id]),e.plugin&&e.plugin.type&&ge.a.remove(e.plugin.type),e.plugin&&e.plugin.terminate)try{console.log("terminating plugin ",e.plugin),"function"==typeof e.plugin.terminate&&(e.plugin.terminate(),console.log("terminated."))}finally{delete e.plugin}e.plugin=null,console.log("reloading plugin ",e);var r=t.parsePluginCode(e.code,e);("iframe"==r.mode&&r.tags.includes("window")?t.preLoadPlugin(r):t.loadPlugin(r)).then(function(o){console.log("new plugin loaded",o),e.name=o.name,e.type=o.type,e.plugin=o,t.$refs.workflow&&t.$refs.workflow.setupJoy(),n(o)}).catch(function(t){e.name=null,e.type=null,e.plugin=null,o(t)})})},savePlugin:function(e){var t=this,n=e.code,o=this.parsePluginCode(n,{});o.code=n,o._id=o.name.replace(/ /g,"_");var i=function(){t.db.put(o,{force:!0}).then(function(e){console.log("Successfully installed!"),t.show(o.name+" has been sucessfully saved.")}).catch(function(e){t.show("failed to save the plugin."),console.error(e)})};this.db.get(o._id).then(function(e){return t.db.remove(e)}).then(function(e){i()}).catch(function(e){i()})},reloadPythonPlugins:function(){var e=!0,t=!1,n=void 0;try{for(var o,i=h()(this.installed_plugins);!(e=(o=i.next()).done);e=!0){var a=o.value;"pyworker"==a.mode&&this.reloadPlugin(a)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}},removePythonPlugins:function(){for(var e in this.plugins)if(this.plugins.hasOwnProperty(e)){var t=this.plugins[e];if("pyworker"==t.mode)try{ge.a.remove(t.config.type),console.log("terminating ",t),"function"==typeof t.terminate&&t.terminate()}catch(e){}}},reloadPlugins:function(){var e=this;if(this.plugins)for(var t in this.plugins)if(this.plugins.hasOwnProperty(t)){var n=this.plugins[t];if("function"==typeof n.terminate)try{n.terminate()}catch(e){console.error(e)}this.plugins[t]=null,this.plugin_names[n.name]=null}this.plugins={},this.plugin_names={},this.db.allDocs({include_docs:!0,attachments:!0,sort:"name"}).then(function(t){var n=[];e.workflow_list=[],e.installed_plugins=[];for(var o=0;o<t.total_rows;o++){var i=t.rows[o].doc;if(i.workflow)e.workflow_list.push(i);else{e.installed_plugins.push(i);try{!function(){var t=e.parsePluginCode(i.code,i),o=e.resumable_plugins.filter(function(e){return e.name==t.name&&e.type==t.type}),a=null;o.length>0&&(a=o[0]),"iframe"==t.mode&&t.tags.includes("window")?n.push(e.preLoadPlugin(t,a)):n.push(e.loadPlugin(t,a))}()}catch(e){console.error(e),alert('Error occured when loading plugin "'+i.name+'": '+e.toString())}}}e.plugin_loaded=!0,e.loading=!1,e.$forceUpdate()}).catch(function(t){console.error(t),e.loading=!1})},closeAll:function(){this.windows=[],this.default_window_pos={i:0,x:0,y:0,w:5,h:5}},showProgress:function(e){this.progress=e<1?100*e:e,this.$forceUpdate()},showStatus:function(e){this.status_text=e,this.$forceUpdate()},addWindow:function(e){this.generateGridPosition(e),this.windows.push(e),this.store.event_bus.$emit("add_window",e)},closePluginDialog:function(e){this.showPluginDialog=!1;var t=p()(this._plugin_dialog_promise,2),n=t[0],o=t[1];e?n(this.$refs.plugin_dialog_joy.joy.get_config()):o(),this._plugin_dialog_promise=null},windowSelected:function(e){console.log("activate window: ",e),this.active_windows=e},generateGridPosition:function(e){e.i=this.default_window_pos.i.toString(),e.w=e.w||this.default_window_pos.w,e.h=e.h||this.default_window_pos.h,e.x=this.default_window_pos.x,e.y=this.default_window_pos.y,this.default_window_pos.x=this.default_window_pos.x+this.default_window_pos.w,this.default_window_pos.x>=20&&(this.default_window_pos.x=0,this.default_window_pos.y=this.default_window_pos.y+this.default_window_pos.h),this.default_window_pos.i=this.default_window_pos.i+1},loadFiles:function(){for(var e=this,t=function(t){var n=e.selected_files[t],o=n.name.split("."),i=o[o.length-1];e.registered.extensions[i]&&function(){var t=e.registered.extensions[i];n.loaders={};for(var o=function(o){console.log("trying to open the file with ",t[o].name,t[o]),n.loaders[t[o].name]=y()(w.a.mark(function i(){var a;return w.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a={},!t[o].config||!t[o].config.ui){i.next=5;break}return i.next=4,e.showDialog(t[o].config);case 4:a=i.sent;case 5:t[o].api.run({op:{},config:a,data:{file:n}}).then(function(t){t&&(console.log("result",t),t.name=t.name||"result",t.type=t.type||"imjoy/generic",e.addWindow(t))});case 6:case"end":return i.stop()}},i,e)}))},a=0;a<t.length;a++)o(a)}()},n=0;n<this.selected_files.length;n++)t(n);var o={name:"Files",type:"imjoy/files",config:{},data:{files:this.selected_files}};this.addWindow(o)},clearWorkflow:function(){this.workflow_joy_config.data="",this.$refs.workflow.setupJoy(!0)},runWorkflow:function(e){var t=this;console.log("run workflow.",this.active_windows);var n=this.active_windows[this.active_windows.length-1]||{};this.status_text="",e.workflow.execute(n.data||{}).then(function(e){e.target&&d()(e.target).length>0&&(console.log("result",e),e.name="result",e.type="imjoy/generic",e.config=e.data,e.data=e.target,e.variables=e.target&&e.target._variables,t.createWindow(e)),t.progress=100}).catch(function(e){console.error(e),t.status_text=e.toString()||"Error."})},saveWorkflow:function(e){var t=this,n=prompt("Please enter a name for the workflow","default");if(null!=n){var o={};o.name=n,o._id=n+"_workflow",o.workflow=v()(e.top.data),console.log("saving workflow: ",o),this.db.put(o,{force:!0}).then(function(e){console.log("Successfully saved!"),t.workflow_list.push(o),t.show(n+" has been sucessfully saved.")}).catch(function(e){t.show("failed to save the workflow."),console.error(e),alert("error occured: "+e.toString())})}},loadWorkflow:function(e){this.workflow_joy_config.data=JSON.parse(e.workflow),this.$refs.workflow.setupJoy(),console.log(e)},removeWorkflow:function(e){var t=this;console.log("removing: ",e),this.db.get(e._id).then(function(e){return t.db.remove(e)}).then(function(n){var o=t.workflow_list.indexOf(e);o>-1&&t.workflow_list.splice(o,1),console.log("Successfully removed!"),t.show(name+" has been sucessfully removed.")}).catch(function(e){t.show("failed to remove the workflow."),console.error(e),alert("error occured: "+e.toString())})},runOp:function(e){var t=this;console.log("run op.",this.active_windows);var n=this.active_windows[this.active_windows.length-1]||{};e.joy._panel.execute(n.data||{}).then(function(e){e.target&&d()(e.target).length>0&&(console.log("result",e),e.name="result",e.type="imjoy/generic",e.config=e.data,e.data=e.target,e.variables=e.target&&e.target._variables,t.createWindow(e)),t.progress=100}).catch(function(n){console.error(n),t.status_text=e.name+"->"+(n.toString()||"Error.")})},selectFileChanged:function(e){console.log(e),this.selected_file=e[0],this.selected_files=e},closePanel:function(e){},parsePluginCode:function(e,t){var n=(t=t||{}).url;if(n&&n.endsWith(".js"))t.lang=t.lang||"javascript",t.script=e,t.style=null,t.window=null;else{console.log("parsing the plugin file");var o=pe(e);console.log("code parsed from",o);for(var i=0;i<o.customBlocks.length;i++)if("config"==o.customBlocks[i].type){t=JSON.parse(o.customBlocks[i].content),console.log("loading config from .html file",t);break}t.script=o.script.content,t.lang=o.script.attrs.lang||"javascript";for(var a=0;a<o.customBlocks.length;a++)if("window"==o.customBlocks[a].type){t.window=o.customBlocks[a].content;break}t.window=t.window||null,o.styles.length>0?t.style=o.styles[0].content:t.style=null}if(t.type=t.type||t.name,t._id=t._id||null,t.url=n,t.code=e,t.id=t.name.trim().replace(/ /g,"_")+"_"+O(),!E(t)){var r=E.errors(t);throw console.error("Invalid plugin config: "+t.name,r),r}return t},preLoadPlugin:function(e,t){var n=this,o={name:e.name,mode:e.mode,type:e.type,tags:e.tags,ui:e.ui,inputs:e.inputs,outputs:e.outputs};return new k.a(function(i,a){t?(o.id=t.id,o.initialized=!0):(o.id=e.name.trim().replace(/ /g,"_")+"_"+O(),o.initialized=!1);var r=ve.a.assign({},e,o),s={id:o.id,name:o.name,type:o.type,config:r,mode:e.mode};n.plugins[s.id]=s,n.plugin_names[s.name]=s,o.force_show=!1,s.api={run:function(t){var o={};o.type=e.type,o.name=e.name,o.data=t.data,o.config=t.config,n.createWindow(o)}},n.register(o,{id:o.id}),console.log("sucessfully preloaded plugin: ",s),i(s)})},loadPlugin:function(e,t){var n=this;return this.status_text="",e=function e(t){if(!t)return t;var n,o,i;for(i in n=Array.isArray(t)?[]:{},t)o=t[i],n[i]="object"===(void 0===o?"undefined":l()(o))?e(o):o;return n}(e),new k.a(function(o,i){var a={};t?(a.id=t.id,a.initialized=!0):(a.id=e.name.trim().replace(/ /g,"_")+"_"+O(),a.initialized=!1),a.context=n.pluing_context,"pyworker"==e.mode&&(n.socket||console.error("plugin engine is not connected."));var r=ve.a.assign({},e,a),s=new jailed.DynamicPlugin(r,n.plugin_api);s.whenConnected(function(){if(!s.api)throw console.error("error occured when loading plugin."),"error occured when loading plugin.";e.type&&n.register(e,{id:s.id}),e.extensions&&e.extensions.length>0&&n.registerExtension(e.extensions,s),s.api.setup().then(function(e){console.log("sucessfully setup plugin: ",s),o(s)}).catch(function(t){console.error("error occured when loading plugin "+e.name+": ",t),i(t),s.terminate()})}),s.whenFailed(function(t){t&&(n.status_text=e.name+"-> Error: "+t,n.show("error occured when loading "+e.name+": "+t)),console.error("error occured when loading "+e.name+": ",t),s.terminate()}),n.plugins[s.id]=s,n.plugin_names[s.name]=s})},runPlugin:function(e,t,n){var o=this;return y()(w.a.mark(function i(){var a,r;return w.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=void 0,n&&n.id?a=o.plugins[n.id]:(a=o.plugins[t.id],t=null),!(r=o.plugin_names[e])){i.next=14;break}return(t=t||{}).op={type:a.type,name:a.name},t.config=t.config||{},t.data=t.data||{},t.variables=t.variables||{},i.next=11,r.api.run(t);case 11:return i.abrupt("return",i.sent);case 14:throw"plugin with type "+e+" not found.";case 15:case"end":return i.stop()}},i,o)}))()},register:function(e,t){var n,o=this;try{var i=this.plugins[t.id];if(e.type=e.type||e.name,e.mode=e.mode||"webworker",e.show_panel=e.show_panel||!1,e.ui=e.ui||e.name,console.log("registering op",e),!D(e)){var a=D.errors(e);throw console.error("Error occured during registering "+e.name,a),a}if(console.log("creating Op: ",e,i),i&&i.api&&i.api.run){var r=(n=y()(w.a.mark(function e(t){var n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.api.run({op:{name:t.op.name,type:t.op.type},config:t.data,data:t.target,variables:t.target&&t.target._variables});case 2:return(n=e.sent)&&n.data&&n.config?(t.data=n.config,t.target=n.data):n&&(t.data=null,t.target=n),e.abrupt("return",t);case 5:case"end":return e.stop()}},e,o)})),function(e){return n.apply(this,arguments)});e.onexecute=r}else console.log("WARNING: no run function found in the config, this op won't be able to do anything: "+e.name),e.onexecute=function(){console.log("WARNING: no run function defined.")};if(e.onupdate&&"object"==l()(e.onupdate))for(var s in e.onupdate)if(e.onupdate.hasOwnProperty(s)){var c=i.api[e.onupdate[s]];e.onupdate[s]=c}console.log("adding joy op",e);var d=e;d.init=d.ui||d.name,ge.a.add(d),i.type=e.type,console.log("register op plugin: ",i.config),this.registered.ops[e.type]=i.config;var u={name:e.name,id:t.id,ui:"{id: '_panel', type: '"+e.type+"'}",onexecute:e.onexecute};if(i.ops=i.ops||[],i.ops.push(u),this.$refs.workflow&&this.$refs.workflow.setupJoy(),console.log("creating panel: ",u),this.$forceUpdate(),e.tags.includes("window")){if("iframe"!=e.mode)throw'Window plugin must be with type "iframe"';console.log("register window plugin: ",i.config),this.registered.windows[e.type]=i.config}if(e.tags.includes("file_importer"))throw"file importer not supported yet";if(e.tags.includes("file_exporter"))throw"file importer not supported yet";return!0}catch(e){throw console.error(e),e}},renderWindow:function(e){var t=this;console.log("rendering window",e);var n=ve.a.assign({},e.plugin,e),o=new jailed.DynamicPlugin(n,this.plugin_api);o.whenConnected(function(){o.api||console.error("the window plugin seems not ready."),o.api.setup().then(function(n){console.log("sucessfully setup the window plugin: ",o,e),o.api.run({data:e.data,config:e.config,op:e.op}).catch(function(e){t.status_text=o.name+"->"+e,console.error("error in the run function of plugin "+o.name,e)})}).catch(function(t){console.error("error occured when loading the window plugin "+e.name+": ",t),o.terminate()})}),o.whenFailed(function(t){console.error("error occured when loading "+e.name+":",t),alert("error occured when loading "+e.name),o.terminate()})},createWindow:function(e,t){var n=this;try{if(e.config=e.config||{},e.data=e.data||null,e.force_show=e.force_show||!1,e.panel=e.panel||null,!S(e)){var o=S.errors(e);throw console.error("Error occured during creating window "+e.name,o),o}if(console.log("window config",e),e.type.startsWith("imjoy"))return this.addWindow(e),!0;var i=this.registered.windows[e.type];if(console.log(i),!i)throw console.error("no plugin registered for window type: ",e.type),e.type;var a=e;if(a.mode=i.mode,a.id=i.name.trim().replace(/ /g,"_")+"_"+O(),console.log("creating window: ",a),"iframe"!=a.mode)throw'Window plugin must be with mode "iframe"';a.iframe_container="plugin_window_"+a.id+O(),console.log("changing id..."),a.iframe_window=null,a.plugin=i,a.context=this.pluing_context,e.force_show?(a.click2load=!1,a.loadWindow=null,this.showPluginWindow(a).then(function(){n.renderWindow(a)})):(a.click2load=!0,a.renderWindow=this.renderWindow,this.showPluginWindow(a))}catch(e){throw console.error(e),e}return!0},showDialog:function(e,t){var n=this;return new k.a(function(t,o){n.plugin_dialog_config=e,n.showPluginDialog=!0,n._plugin_dialog_promise=[t,o]})},showPluginWindow:function(e){var t=this;return new k.a(function(n,o){if(e.type=e.type||"joy_panel",e.data=e.data||null,e.config=e.config||{},e.panel=e.panel||null,!S(e)){var i=S.errors(e);throw console.error("Error occured during creating window "+e.name,i),i}console.log("creating plugin window: ",e),t.addWindow(e),console.log("added the window")})}}},_e={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"imjoy noselect"},[e._m(0),e._v(" "),n("md-app",[n("md-app-toolbar",{staticClass:"md-dense",attrs:{"md-elevation":"0"}},[n("div",{staticClass:"md-toolbar-section-start"},[e.menuVisible?e._e():n("md-button",{staticClass:"md-primary md-icon-button",on:{click:function(t){e.menuVisible=!0}}},[n("md-icon",[e._v("menu")]),e._v(" "),n("md-tooltip",[e._v("show sidebar")])],1),e._v(" "),e.menuVisible?e._e():n("md-button",{staticClass:"md-medium-hide",attrs:{to:"/"}},[n("div",{staticClass:"site-title"},[e._v("ImJoy.io"),n("span",{staticClass:"superscript md-small-hide"},[e._v("alpha")])]),e._v(" "),n("md-tooltip",[e._v("ImJoy home")])],1),e._v(" "),n("md-menu",[n("md-button",{staticClass:"md-button",attrs:{"md-menu-trigger":""}},[n("span",{staticClass:"subheader-title",staticStyle:{flex:"1"}},[e._v("Image Processing with Joy")]),e._v(" "),n("md-tooltip",[e._v("Switch workspace")])],1),e._v(" "),n("md-menu-content",[e._l(e.workspace_list,function(t){return n("md-menu-item",{key:t.name,on:{click:function(n){e.switchWorkspace(t)}}},[n("span",[e._v(e._s(t))]),n("md-icon",[e._v("forward")])],1)}),e._v(" "),n("md-menu-item",{on:{click:function(t){e.showNewWorkspaceDialog=!0}}},[n("md-icon",[e._v("add")]),e._v("New Workspace\n            ")],1)],2)],1)],1),e._v(" "),n("span",{staticClass:"status-text md-small-hide",class:e.status_text.includes("rror")?"error-message":""},[e._v(e._s(e.status_text))]),e._v(" "),n("div",{staticClass:"md-toolbar-section-end"},[n("md-snackbar",{staticClass:"md-accent",attrs:{"md-position":"center","md-active":e.show_snackbar,"md-duration":e.snackbar_duration},on:{"update:mdActive":function(t){e.show_snackbar=t}}},[n("span",[e._v(e._s(e.snackbar_info))]),e._v(" "),n("md-button",{staticClass:"md-accent",on:{click:function(t){e.show_snackbar=!1}}},[e._v("close")])],1),e._v(" "),n("md-button",{staticClass:"md-icon-button md-accent",on:{click:e.closeAll}},[n("md-icon",[e._v("cancel")]),e._v(" "),n("md-tooltip",[e._v("Close all windows")])],1),e._v(" "),n("md-button",{staticClass:"md-icon-button",attrs:{disabled:!0}},[n("md-icon",[e._v("save")]),e._v(" "),n("md-tooltip",[e._v("Save all windows")])],1),e._v(" "),n("md-menu",{attrs:{"md-size":"big","md-direction":"bottom-end"}},[n("md-button",{staticClass:"md-icon-button",class:e.engine_connected?"md-primary":"md-accent",attrs:{"md-menu-trigger":""}},[n("md-icon",[e._v(e._s(e.engine_connected?"sync":"sync_disabled"))]),e._v(" "),n("md-tooltip",[e._v("Connection to the Plugin Engine")])],1),e._v(" "),n("md-menu-content",[n("md-menu-item",{attrs:{disabled:!0}},[n("span",[e._v(e._s(e.engine_status))])]),e._v(" "),n("md-menu-item",{on:{click:function(t){e.connectEngine(e.engine_url)}}},[n("span",[e._v("Connect")]),e._v(" "),n("md-icon",[e._v("settings_ethernet")])],1),e._v(" "),n("md-menu-item",{on:{click:function(t){e.disconnectEngine()}}},[n("span",[e._v("Disconnect")]),e._v(" "),n("md-icon",[e._v("clear")])],1),e._v(" "),n("md-menu-item",{on:{click:function(t){e.showPluginEngineInfo=!0}}},[n("span",[e._v("About Plugin Engine")]),e._v(" "),n("md-icon",[e._v("info")])],1)],1)],1),e._v(" "),n("md-button",{staticClass:"md-icon-button"},[n("md-icon",[e._v("help")]),e._v(" "),n("md-tooltip",[e._v("Open help information.")])],1)],1)]),e._v(" "),n("md-app-drawer",{attrs:{"md-active":e.menuVisible,"md-persistent":"full"},on:{"update:mdActive":function(t){e.menuVisible=t}}},[n("md-speed-dial",{staticClass:"md-top-left speed-dial",attrs:{"md-event":"hover","md-effect":"scale","md-direction":"bottom"}},[n("md-speed-dial-target",{staticClass:"md-primary"},[n("md-icon",[e._v("add")])],1),e._v(" "),n("md-speed-dial-content",[n("md-button",{staticClass:"md-icon-button md-primary",on:{click:function(t){e.$refs.file_select.openPicker()}}},[n("md-icon",[e._v("insert_drive_file")]),e._v(" "),n("md-tooltip",[e._v("Open a file")])],1),e._v(" "),n("md-button",{staticClass:"md-icon-button md-primary",on:{click:function(t){e.$refs.folder_select.openPicker()}}},[n("md-icon",[e._v("folder_open")]),e._v(" "),n("md-tooltip",[e._v("Open a folder")])],1),e._v(" "),n("md-button",{staticClass:"md-icon-button md-accent",on:{click:function(t){e.showAddPluginDialog=!0}}},[n("md-icon",[e._v("extension")]),e._v(" "),n("md-tooltip",[e._v("Install or create a new plugin")])],1)],1)],1),e._v(" "),n("div",{staticClass:"md-toolbar-row"},[n("div",{staticClass:"md-toolbar-section-start"},[n("md-field",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[n("md-file",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"file_select",on:{"md-change":e.selectFileChanged},model:{value:e.folder_select,callback:function(t){e.folder_select=t},expression:"folder_select"}})],1),e._v(" "),n("md-field",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[n("md-file",{ref:"folder_select",attrs:{webkitdirectory:"",mozdirectory:"",msdirectory:"",odirectory:"",directory:"",multiple:""},on:{"md-change":e.selectFileChanged},model:{value:e.file_select,callback:function(t){e.file_select=t},expression:"file_select"}})],1),e._v(" "),n("md-button",{staticClass:"site-button",attrs:{to:"/"}},[n("div",{staticClass:"site-title"},[e._v("ImJoy.io"),n("span",{staticClass:"superscript"},[e._v("alpha")])])])],1),e._v(" "),n("div",{staticClass:"md-toolbar-section-end"},[n("md-button",{staticClass:"md-icon-button md-primary",on:{click:function(t){e.showSettingsDialog=!0}}},[n("md-icon",[e._v("settings")]),e._v(" "),n("md-tooltip",[e._v("Show settings and installed plugins")])],1),e._v(" "),n("md-button",{staticClass:"md-icon-button md-dense md-raised",on:{click:function(t){e.menuVisible=!e.menuVisible}}},[n("md-icon",[e._v("keyboard_arrow_left")]),e._v(" "),n("md-tooltip",[e._v("Hide sidebar")])],1)],1)]),e._v(" "),n("br"),e._v(" "),n("md-card",[n("md-card-header",[n("div",{staticClass:"md-layout md-gutter md-alignment-center-space-between"},[n("div",{staticClass:"md-layout-item md-size-70"},[n("span",{staticClass:"md-subheading"},[e._v("Workflow")])]),e._v(" "),n("div",{staticClass:"md-layout-item"},[n("md-button",{staticClass:"md-icon-button",on:{click:function(t){e.clearWorkflow()}}},[n("md-icon",[e._v("clear")]),e._v(" "),n("md-tooltip",[e._v("Clear workflow")])],1)],1)])]),e._v(" "),n("md-card-content",[e.plugin_loaded&&!e.updating_workflow?n("joy",{ref:"workflow",attrs:{config:e.workflow_joy_config}}):e._e(),e._v(" "),e.plugin_loaded?n("md-button",{staticClass:"md-button md-primary",on:{click:function(t){e.runWorkflow(e.workflow_joy_config.joy)}}},[n("md-icon",[e._v("play_arrow")]),e._v("Run\n            "),n("md-tooltip",[e._v("run the workflow")])],1):e._e(),e._v(" "),e.plugin_loaded?n("md-button",{staticClass:"md-button md-primary",on:{click:function(t){e.saveWorkflow(e.workflow_joy_config.joy)}}},[n("md-icon",[e._v("save")]),e._v("Save\n            "),n("md-tooltip",[e._v("save the workflow")])],1):e._e(),e._v(" "),n("md-menu",{attrs:{"md-size":"big"}},[n("md-button",{staticClass:"md-button md-primary",attrs:{disabled:0==e.workflow_list.length,"md-menu-trigger":""}},[n("md-icon",[e._v("more_horiz")]),e._v(" Load\n              "),n("md-tooltip",[e._v("load a workflow")])],1),e._v(" "),n("md-menu-content",e._l(e.workflow_list,function(t){return n("md-menu-item",{key:t.name,on:{click:function(n){e.loadWorkflow(t)}}},[n("span",[e._v(e._s(t.name))]),e._v(" "),n("md-button",{staticClass:"md-icon-button md-accent",on:{click:function(n){n.stopPropagation(),e.removeWorkflow(t)}}},[n("md-icon",[e._v("clear")])],1)],1)}))],1)],1)],1),e._v(" "),e.plugin_loaded?n("div",[n("md-card",[n("md-card-header",[n("div",{staticClass:"md-layout md-gutter md-alignment-center-space-between"},[n("div",{staticClass:"md-layout-item md-size-70"},[n("span",{staticClass:"md-subheading"},[e._v("Plugins")])]),e._v(" "),n("div",{staticClass:"md-layout-item"},[n("md-button",{staticClass:"md-icon-button",on:{click:function(t){e.reloadPlugins()}}},[n("md-icon",[e._v("autorenew")]),e._v(" "),n("md-tooltip",[e._v("Reload plugins")])],1)],1)])]),e._v(" "),n("md-card-content",e._l(e.sortedPlugins(),function(t){return n("div",{key:t.name},[n("md-divider"),e._v(" "),n("md-button",{staticClass:"md-icon-button",on:{click:function(n){e.editPlugin(t.id)}}},[t.config.icon?n("md-icon",[e._v(e._s(t.config.icon))]):n("md-icon",[e._v("extension")])],1),e._v(" "),n("md-button",{staticClass:"joy-run-button md-primary",attrs:{disabled:t._disconnected},on:{click:function(n){t.ops&&t.ops[0]&&e.runOp(t.ops[0])}}},[e._v("\n                "+e._s(t.name)+"\n              ")]),e._v(" "),n("md-button",{staticClass:"md-icon-button",on:{click:function(n){t.panel_expanded=!t.panel_expanded,e.$forceUpdate()}}},[t.panel_expanded?n("md-icon",[e._v("expand_less")]):n("md-icon",[e._v("expand_more")])],1),e._v(" "),e._l(t.ops,function(o,i){return n("div",{key:o.id+o.name},[n("md-button",{directives:[{name:"show",rawName:"v-show",value:t.panel_expanded&&0!=i,expression:"plugin.panel_expanded && i != 0"}],staticClass:"md-icon-button",attrs:{disabled:!0}},[n("md-icon",[e._v("remove")])],1),e._v(" "),n("md-button",{directives:[{name:"show",rawName:"v-show",value:t.panel_expanded&&0!=i,expression:"plugin.panel_expanded && i != 0"}],staticClass:"joy-run-button md-primary",attrs:{disabled:t._disconnected},on:{click:function(t){e.runOp(o)}}},[e._v("\n                    "+e._s(o.name)+"\n                ")]),e._v(" "),n("md-button",{directives:[{name:"show",rawName:"v-show",value:t.panel_expanded&&0!=i,expression:"plugin.panel_expanded && i != 0"}],staticClass:"md-icon-button",on:{click:function(t){o.panel_expanded=!o.panel_expanded,e.$forceUpdate()}}},[o.panel_expanded?n("md-icon",[e._v("expand_less")]):n("md-icon",[e._v("expand_more")])],1),e._v(" "),n("joy",{attrs:{config:o,show:t.panel_expanded&&(!!t.panel_expanded&&0==i||o.panel_expanded)||!1}}),e._v(" "),n("md-divider")],1)})],2)}))],1)],1):e._e()],1),e._v(" "),n("md-app-content",{staticClass:"whiteboard-content"},[n("md-progress-bar",{attrs:{"md-mode":"determinate","md-value":e.progress}}),e._v(" "),n("whiteboard",{attrs:{windows:e.windows},on:{select:e.windowSelected}})],1)],1),e._v(" "),n("md-dialog",{attrs:{"md-active":e.showPluginDialog,"md-click-outside-to-close":!1},on:{"update:mdActive":function(t){e.showPluginDialog=t}}},[n("md-dialog-content",[e.plugin_dialog_config?n("div",[n("joy",{ref:"plugin_dialog_joy",attrs:{config:e.plugin_dialog_config,showHeader:!1,controlButtons:!1}})],1):e._e()]),e._v(" "),n("md-dialog-actions",[n("md-button",{staticClass:"md-primary",on:{click:function(t){e.closePluginDialog(!0)}}},[e._v("OK")]),e._v(" "),n("md-button",{staticClass:"md-primary",on:{click:function(t){e.closePluginDialog(!1)}}},[e._v("Cancel")])],1)],1),e._v(" "),n("md-dialog",{attrs:{"md-active":e.showNewWorkspaceDialog,"md-click-outside-to-close":!1},on:{"update:mdActive":function(t){e.showNewWorkspaceDialog=t}}},[n("md-dialog-content",[n("md-field",[n("label",{attrs:{for:"workspace_name"}},[e._v("Name")]),e._v(" "),n("md-input",{attrs:{type:"text",name:"workspace_name"},model:{value:e.new_workspace_name,callback:function(t){e.new_workspace_name=t},expression:"new_workspace_name"}})],1)],1),e._v(" "),n("md-dialog-actions",[n("md-button",{staticClass:"md-primary",on:{click:function(t){e.showNewWorkspaceDialog=!1,e.switchWorkspace(e.new_workspace_name)}}},[e._v("OK")]),e._v(" "),n("md-button",{staticClass:"md-primary",on:{click:function(t){e.showNewWorkspaceDialog=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),n("md-dialog-prompt",{attrs:{"md-active":e.showTokenPrompt,"md-title":"What is the connection token?","md-input-maxlength":"36","md-click-outside-to-close":!1,"md-input-placeholder":"Please go to the plugin engine terminal to get the token.","md-confirm-text":"Connect"},on:{"update:mdActive":function(t){e.showTokenPrompt=t},"md-confirm":function(t){e.connectEngine(e.engine_url)}},model:{value:e.connection_token,callback:function(t){e.connection_token=t},expression:"connection_token"}}),e._v(" "),n("md-dialog-confirm",{attrs:{"md-active":e.showPluginEngineInfo,"md-title":"Use the Python Plugin Engine","md-click-outside-to-close":!1,"md-content":'Python plugins are supported by ImJoy with the Python Plugin Engine. If it was already installed, run <strong>python -m imjoy</strong> in a terminal and press <strong>Connect</strong>.<br><br>\n        If not, you need to do the following:<br>\n        &nbsp;&nbsp;Step 1. Install <a href="https://www.anaconda.com/download/" target="_blank">Anaconda (Python3.6 version)</a> <br>\n        &nbsp;&nbsp;Step 2. Run <strong>pip install -U git+https://github.com/oeway/ImJoy-Python#egg=imjoy</strong> in a terminal. <br>\n        &nbsp;&nbsp;Step 3. Run <strong>python -m imjoy</strong> in a terminal to start the engine.<br><br>\n        Once you are ready, click <strong>Connect</strong><br>',"md-confirm-text":"Connect","md-cancel-text":"Cancel"},on:{"update:mdActive":function(t){e.showPluginEngineInfo=t},"md-confirm":function(t){e.connectEngine(e.engine_url)}}}),e._v(" "),n("md-dialog",{attrs:{"md-active":e.showSettingsDialog,"md-click-outside-to-close":!1},on:{"update:mdActive":function(t){e.showSettingsDialog=t}}},[n("md-dialog-content",[n("md-tabs",[n("md-tab",{attrs:{id:"tab-settings","md-label":"General Settings"}},[n("md-field",[n("label",{attrs:{for:"engine_url"}},[e._v("Plugin Engine URL")]),e._v(" "),n("md-input",{attrs:{type:"text",name:"engine_url"},model:{value:e.engine_url,callback:function(t){e.engine_url=t},expression:"engine_url"}})],1),e._v(" "),n("md-button",{staticClass:"md-primary",on:{click:function(t){e.connectEngine(e.engine_url)}}},[e._v("Connect Plugin Engine")]),e._v(" "),n("md-button",{staticClass:"md-primary",on:{click:function(t){e.disconnectEngine()}}},[e._v("Disconnect Plugin Engine")]),e._v(" "),n("p",[e._v(e._s(e.engine_status))])],1),e._v(" "),n("md-tab",{attrs:{id:"tab-installed","md-label":"Installed Plugins"}},[n("plugin-list",{attrs:{plugins:e.installed_plugins,workspace:e.selected_workspace,title:"Installed Plugins"}})],1),e._v(" "),n("md-tab",{attrs:{id:"tab-plugin-store","md-label":"Plugin Store"}},[n("plugin-list",{attrs:{"config-url":"https://raw.githubusercontent.com/oeway/ImJoy-Plugins/master/manifest.json",workspace:e.selected_workspace,title:"Available Plugins"}})],1)],1)],1),e._v(" "),n("md-dialog-actions",[n("md-button",{staticClass:"md-primary",on:{click:function(t){e.showSettingsDialog=!1,e.reloadPlugins()}}},[e._v("OK")])],1)],1),e._v(" "),n("md-dialog",{attrs:{"md-active":e.showAddPluginDialog,"md-click-outside-to-close":!1},on:{"update:mdActive":function(t){e.showAddPluginDialog=t}}},[n("md-dialog-content",[n("md-subheader",[e._v("Create a New Plugin")]),e._v(" "),e._l(e.plugin_templates,function(t,o){return n("md-button",{key:o,staticClass:"md-primary md-raised centered-button",on:{click:function(n){e.newPlugin(t),e.showAddPluginDialog=!1}}},[n("md-icon",[e._v("add")]),e._v(e._s(o)+"\n      ")],1)}),e._v(" "),n("plugin-list",{attrs:{"config-url":"https://raw.githubusercontent.com/oeway/ImJoy-Plugins/master/manifest.json",workspace:e.selected_workspace,title:"Or, install from the Plugin Store"}})],2),e._v(" "),n("md-dialog-actions",[n("md-button",{staticClass:"md-primary",on:{click:function(t){e.showAddPluginDialog=!1,e.reloadPlugins()}}},[e._v("OK")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticStyle:{visibility:"hidden",opacity:"0"},attrs:{id:"dropzone"}},[t("div",{attrs:{id:"textnode"}},[this._v("Drop files to add data.")])])}]};var ye=n("VU/8")(we,_e,!1,function(e){n("h7Em")},"data-v-51464a2b",null).exports,be={name:"about",props:{faq:{type:Boolean,default:!0},footer:{type:Boolean,default:!0}},data:function(){return{router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){},methods:{}},ke={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"about"},[n("md-subheader",[e._v("About ImJoy.io")]),e._v(" "),n("md-card",[n("md-card-header"),e._v(" "),n("md-card-content",{staticClass:"centered-fixed"},[n("md-icon",{staticClass:"md-size-5x md-small-hide",attrs:{"md-src":"static/img/anna-palm-icon-circle.svg"}}),e._v(" "),n("h2",[e._v("Acknowledgements")]),e._v(" "),n("p",[e._v("ImJoy.io project is mainly supported by\n      ")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://www.pasteur.fr",target:"_blank"}},[n("img",{attrs:{id:"ip-img",src:"static/img/Institut_Pasteur_logo.svg",alt:"Institut Pasteur"}})])]),e._v(" "),n("br"),e._v(" "),n("md-button",{staticClass:"md-raised",on:{click:e.api.contact}},[e._v("Contact us")])],1)],1),e._v(" "),e.faq?n("faq"):e._e(),e._v(" "),n("br"),e._v(" "),n("br"),e._v(" "),e.footer?n("md-divider"):e._e(),e._v(" "),e.footer?n("main-footer"):e._e()],1)},staticRenderFns:[]};var Ce=n("VU/8")(be,ke,!1,function(e){n("UpWs")},"data-v-2925121e",null).exports;var xe=n("EFqf"),je=n.n(xe),Pe={name:"faq",data:function(){return{source:"\n\n## How to import script in the plugin?\nThere are two different mode for the plugin to run a certain code: in webworker mode, you can use the original importScripts function, notice that it's synchronized version;\nin iframe mode, we provided a importScripts function, but it's an async version, means you can use promise or await on that.\n\nIn order to unify the code, the recommended way is, if you want to load multiple scripts in order, and use Promise.resolve to normalize the result into a promise.\n\nFor example the following code will behave the same in webworker mode or iframe mode:\n\n```\nPromise.resolve(importScripts(\"https://xxxx/script1.js\", \"https://xxxx/script2.js\")).then(()=>{\n  console.log('scripts loaded.')\n})\n```\n\n\n\n",router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},computed:{compiledMarkdown:function(){return je()(this.source,{sanitize:!0})}},mounted:function(){},methods:{}},Ee={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"faq"},[t("md-subheader",[this._v("FREQUENTLY ASKED QUESTIONS")]),this._v(" "),t("md-card",[t("md-card-header"),this._v(" "),t("md-card-content",[t("div",{domProps:{innerHTML:this._s(this.compiledMarkdown)}})])],1)],1)},staticRenderFns:[]};var De=n("VU/8")(Pe,Ee,!1,function(e){n("A+BG")},"data-v-62bff1b8",null).exports;o.default.use(i.a);var Se=new i.a({base:window.location.pathName,routes:[{path:"/",name:"Home",component:r},{path:"/home",redirect:"/"},{path:"/app",name:"app",component:ye},{path:"/:)",redirect:{name:"app"}},{path:"/imjoy",name:"Imjoy",component:ye},{path:"/about",name:"About",component:Ce},{path:"/faq",name:"FAQ",component:De},{path:"*",redirect:"/"}]}),Oe=n("Lgyv"),Ie=n.n(Oe),$e=(n("4+hh"),n("giDI"),n("GDE4")),We=n.n($e),Ae={name:"navbar",data:function(){return{snackbar_info:"",snackbar_duration:1e3,showSnackbar:!1,screenWidth:window.innerWidth,router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){var e=this;this.screenWidth=window.innerWidth;this.store.event_bus.$on("resize",function(t){e.screenWidth=t.width})},methods:{shareOnTwitter:function(){window.open("http://twitter.com/share?url="+encodeURIComponent("https://imjoy.io")+"&text="+encodeURIComponent(" #ImJoy "),"","left=0,top=0,width=550,height=450,personalbar=0,toolbar=0,scrollbars=0,resizable=0")}}},Te={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"md-toolbar-row"},[n("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[n("md-button",{attrs:{to:"/"}},[n("div",{staticClass:"site-title"},[e._v("ImJoy.io"),n("span",{staticClass:"superscript"},[e._v("alpha")])])]),e._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:"/"!=e.$route.path,expression:"$route.path!='/'"}],staticClass:"md-layout-item md-medium-hide subheader-title"},[e._v("Image processing with joy.")]),e._v(" "),n("div",{staticClass:"md-toolbar-section-end"},[e.screenWidth<600?n("md-menu",{attrs:{"md-size":"medium"}},[n("md-button",{staticClass:"md-primary md-icon-button",attrs:{"md-menu-trigger":""}},[n("md-icon",[e._v("menu")])],1),e._v(" "),n("md-menu-content",[n("md-menu-item",{directives:[{name:"show",rawName:"v-show",value:"/"!=e.$route.path,expression:"$route.path != '/'"}],staticClass:"md-primary md-button menu-button",attrs:{to:"/"}},[e._v("Home")]),e._v(" "),n("md-menu-item",{directives:[{name:"show",rawName:"v-show",value:"/app"!=e.$route.path,expression:"$route.path != '/app'"}],staticClass:"md-primary md-button menu-button",attrs:{to:"/app"}},[e._v("Start ImJoy")]),e._v(" "),n("md-menu-item",{staticClass:"md-primary md-button menu-button",attrs:{href:"https://github.com/oeway/ImJoy"}},[e._v("Source")]),e._v(" "),n("md-menu-item",{staticClass:"md-primary md-button menu-button",attrs:{href:"/static/docs/"}},[e._v("Docs")]),e._v(" "),n("md-menu-item",{directives:[{name:"show",rawName:"v-show",value:"/about"!=e.$route.path,expression:"$route.path != '/about'"}],staticClass:"md-primary md-button menu-button",attrs:{to:"/about"}},[e._v("About")])],1)],1):e._e(),e._v(" "),e.screenWidth>=600?n("md-button",{directives:[{name:"show",rawName:"v-show",value:"/"!=e.$route.path,expression:"$route.path != '/'"}],staticClass:"md-accent",attrs:{to:"/"}},[n("md-icon",[e._v("home")]),e._v(" Home\n            "),n("md-tooltip",[e._v("Home Page")])],1):e._e(),e._v("\n          \n          "),e.screenWidth>=600?n("md-button",{directives:[{name:"show",rawName:"v-show",value:"/app"!=e.$route.path,expression:"$route.path != '/app'"}],staticClass:"md-accent",attrs:{to:"/app"}},[n("md-icon",[e._v("mood")]),e._v(" ImJoy\n            "),n("md-tooltip",[e._v("Start ImJoy App")])],1):e._e(),e._v("\n          \n          "),e.screenWidth>=600?n("md-button",{staticClass:"md-accent",attrs:{href:"https://github.com/oeway/ImJoy",target:"_blank"}},[n("md-icon",{staticClass:"md-size-1x svg-icon",attrs:{"md-src":"static/img/github.svg"}}),e._v("source\n            "),n("md-tooltip",[e._v("Source code on Github")])],1):e._e(),e._v("\n          \n          "),e.screenWidth>=600?n("md-button",{staticClass:"md-accent",attrs:{href:"/static/docs/"}},[n("md-icon",[e._v("library_books")]),e._v("docs\n            "),n("md-tooltip",[e._v("Documentation")])],1):e._e(),e._v(" "),e._v("\n          \n          "),e.screenWidth>=600?n("md-button",{directives:[{name:"show",rawName:"v-show",value:"/about"!=e.$route.path,expression:"$route.path != '/about'"}],staticClass:"md-accent",attrs:{to:"/about"}},[n("md-icon",[e._v("info")]),e._v(" About\n            "),n("md-tooltip",[e._v("About ImJoy.io")])],1):e._e()],1)],1),e._v(" "),n("md-snackbar",{staticClass:"md-accent",attrs:{"md-position":"center","md-active":e.showSnackbar,"md-duration":e.snackbar_duration},on:{"update:mdActive":function(t){e.showSnackbar=t}}},[n("span",[e._v(e._s(e.snackbar_info))]),e._v(" "),n("md-button",{staticClass:"md-accent",on:{click:function(t){e.showSnackbar=!1}}},[e._v("close")])],1)],1)},staticRenderFns:[]};var Re=n("VU/8")(Ae,Te,!1,function(e){n("/aKM")},"data-v-502890c6",null).exports,Le={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return"/app"!=e.$route.path&&"/app"!=e.$route.path?n("div",{staticClass:"footer"},[n("div",{staticClass:"md-layout md-alignment-center-center"},[n("md-button",{staticClass:"md-accent footer-button",attrs:{target:"_blank"},on:{click:function(t){e.contact()}}},[e._v("Ask a question")]),e._v(" "),n("md-button",{staticClass:"md-accent footer-button",attrs:{target:"_blank",href:"https://github.com/oeway/ImJoy/issues"}},[e._v("Create an issue on Github")])],1),e._v(" "),n("div",{staticClass:"md-layout md-alignment-center-center"},[n("md-button",{staticClass:"footer-button",attrs:{href:"https://creativecommons.org/licenses/by/4.0/",target:"_blank"}},[n("md-tooltip",[e._v("Except where otherwise noted, content on this site is licensed under a Creative Commons Attribution 4.0 International license.")]),e._v(" "),n("img",{attrs:{id:"cc-by-img",src:"static/img/by.svg",alt:"CC BY 4.0"}}),e._v(" Site content licensed under CC BY 4.0\n    ")],1),e._v(" "),n("md-button",{staticClass:"footer-button",on:{click:function(t){e.mode="about",e.showDialog=!0}}},[e._v("About ImJoy.io")])],1),e._v(" "),n("div",{staticClass:"md-layout md-alignment-center-center"},[n("md-button",{staticClass:"footer-button",attrs:{href:"https://github.com/oeway",target:"_blank"}},[e._v("Made by Wei OUYANG with "),n("span",{staticClass:"red"},[e._v("")])]),e._v(" "),n("md-button",{staticClass:"footer-button",attrs:{target:"_blank",href:"https://sites.google.com/site/imagingandmodeling/"}},[e._v("Powered by Imaging and Modeling Unit")]),e._v(" "),e._m(0)],1),e._v(" "),n("md-dialog",{attrs:{"md-active":e.showDialog},on:{"update:mdActive":function(t){e.showDialog=t}}},[n("md-dialog-content",["about"==e.mode?n("about",{attrs:{footer:!1,faq:!1}}):e._e(),e._v(" "),"tos"==e.mode?n("tos"):e._e()],1),e._v(" "),n("md-dialog-actions",[n("md-button",{staticClass:"md-primary",on:{click:function(t){e.showDialog=!1}}},[e._v("OK")])],1)],1),e._v(" "),n("md-dialog",{attrs:{"md-active":e.showQuestion,id:"question-dialog"},on:{"update:mdActive":function(t){e.showQuestion=t}}},[n("md-toolbar",{staticClass:"md-primary"},[n("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[n("md-subheader",[e._v("\n          Contact us\n        ")]),e._v(" "),n("div",{staticClass:"md-toolbar-section-end"},[n("md-button",{staticClass:"md-icon-button",on:{click:function(t){e.showQuestion=!1}}},[n("md-icon",[e._v("close")])],1)],1)],1)]),e._v(" "),n("md-dialog-content",[n("div",{staticClass:"holds-the-iframe"},[n("iframe",{attrs:{id:"typeform-full",width:"100%",height:"100%",frameborder:"0",src:"https://oeway.typeform.com/to/qyJOIy"}})])]),e._v(" "),n("md-dialog-actions",[n("md-button",{staticClass:"md-primary",on:{click:function(t){e.showQuestion=!1}}},[e._v("Close")])],1)],1)],1):e._e()},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("a",{attrs:{href:"https://www.pasteur.fr",target:"_blank"}},[t("img",{attrs:{id:"ip-img",src:"static/img/Institut_Pasteur_logo.svg",alt:"Institut Pasteur"}})])}]};var Ne=n("VU/8")({name:"main-footer",data:function(){return{mode:"about",showDialog:!1,showQuestion:!1,router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){this.api.contact=this.contact},methods:{contact:function(){this.showQuestion=!0}}},Le,!1,function(e){n("L66j")},"data-v-9768854e",null).exports,Me=n("woOf"),Ue=n.n(Me),Be={name:"whiteboard",props:{windows:{type:Array,default:function(){return null}},pluginWindows:{type:Array,default:function(){return null}}},data:function(){return{row_height:30,column_width:30,active_windows:[],show_overlay:!1,router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},created:function(){this.store.event_bus.$on("add_window",this.onWindowAdd)},mounted:function(){},beforeDestroy:function(){this.store.event_bus.$off("add_window",this.onWindowAdd)},methods:{onWindowAdd:function(e){this.selectWindow(e,{})},close:function(e){console.log("close",e);var t=this.active_windows.indexOf(this.windows[e]);t>=0&&(this.active_windows[t].selected=!1,this.active_windows.splice(t,1),this.$emit("select",this.active_windows,null)),this.windows.splice(e,1)},fullScreen:function(e){console.log("---------------",this.$refs.whiteboard.clientHeight,this.row_height);var t=parseInt(this.$refs.whiteboard.clientHeight/this.row_height)-10,n=parseInt(this.$refs.whiteboard.clientWidth/this.column_width)-1;e._h=e.h,e._w=e.w,e.h=t,e.w=n},normalSize:function(e){e.h=e._h||5,e.w=e._w||5,e._w=null,e._h=null},duplicate:function(e){var t=Ue()({},e);t.iframe_container&&(t.iframe_container="plugin_window_"+t.id+O()),t.i=t.i+"_",t.click2load||(t.click2load=!0),e.renderWindow&&(t.renderWindow=e.renderWindow),this.windows.push(t)},unselectWindows:function(){if(this.active_windows&&this.active_windows.length>0){for(var e=0;e<this.active_windows.length;e++)this.active_windows[e].selected=!1;this.active_windows=[],this.$emit("select",[],null),this.$forceUpdate()}},selectWindow:function(e,t){if(e.selected=!0,this.active_windows.length<=0||this.active_windows[this.active_windows.length-1]!==e){if(!t.shiftKey)for(var n=0;n<this.active_windows.length;n++)this.active_windows[n].selected=!1;t.shiftKey&&this.active_windows.length>0?this.active_windows.push(e):this.active_windows=[e],this.$emit("select",this.active_windows,e)}else if(!t.shiftKey&&this.active_windows.length>1){for(var o=0;o<this.active_windows.length;o++)this.active_windows[o]!==e&&(this.active_windows[o].selected=!1);this.active_windows=[e]}this.$forceUpdate()},focusWindow:function(e){this.show_overlay=!0,this.selectWindow(e,{})},stopDragging:function(){var e=this;setTimeout(function(){e.show_overlay=!1,e.$forceUpdate()},300)},printObject:function(e,t){console.log(e,t)},dataSummary:function(e){return"array"==typeof e.data?e.type+", "+l()(e.data)+", length: "+e.data.length:e.data.buffer&&"[object ArrayBuffer]"===Object.prototype.toString.call(e.data.buffer)?e.type+", typedarray, length: "+e.data.length:"object"==l()(e.data)?e.type+", "+l()(e.data)+", length: "+d()(e.data).length:""+e.type}}},Fe={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"whiteboard",staticClass:"whiteboard noselect",on:{click:function(t){e.unselectWindows()}}},[e.show_overlay?n("div",{staticClass:"overlay",on:{click:function(t){e.show_overlay=!1}}}):e._e(),e._v(" "),n("grid-layout",{attrs:{layout:e.windows,"col-num":20,"is-mirrored":!1,"auto-size":!0,"row-height":e.row_height,"col-width":e.column_width,"is-draggable":!0,"is-resizable":!0,"vertical-compact":!0,margin:[10,10],"use-css-transforms":!0}},e._l(e.windows,function(t,o){return n("grid-item",{key:t.iframe_container,attrs:{"drag-ignore-from":".ace_editor",x:t.x,y:t.y,w:t.w,h:t.h,i:t.i},on:{resize:function(n){e.focusWindow(t)},move:function(n){e.focusWindow(t)},resized:function(t){e.show_overlay=!1},moved:function(t){e.show_overlay=!1}}},[n("md-card",[n("md-card-expand",[n("md-card-actions",{class:t.selected?"window-selected":"window-header",attrs:{"md-alignment":"space-between"}},[t.panel?n("md-card-expand-trigger",[n("md-button",{staticClass:"md-icon-button"},[n("md-icon",[e._v("keyboard_arrow_down")])],1)],1):e._e(),e._v(" "),t.panel?e._e():n("div"),e._v(" "),n("div",{staticClass:"window-title noselect",on:{click:function(n){n.stopPropagation(),e.selectWindow(t,n)}}},[e._v(e._s(t.name+"(#"+t.i+")"))]),e._v(" "),n("div",[n("md-menu",{attrs:{"md-size":"big","md-direction":"bottom-end"}},[n("md-button",{staticClass:"md-icon-button",attrs:{"md-menu-trigger":""}},[n("md-icon",[e._v("more_vert")])],1),e._v(" "),n("md-menu-content",[t._h&&t._w?n("md-menu-item",{on:{click:function(n){n.stopPropagation(),e.normalSize(t)}}},[n("span",[e._v("Normal view")]),e._v(" "),n("md-icon",[e._v("fullscreen")])],1):n("md-menu-item",{on:{click:function(n){n.stopPropagation(),e.fullScreen(t)}}},[n("span",[e._v("Fullscreen")]),e._v(" "),n("md-icon",[e._v("fullscreen")])],1),e._v(" "),n("md-menu-item",{on:{click:function(n){n.stopPropagation(),e.duplicate(t)}}},[n("span",[e._v("Duplicate")]),e._v(" "),n("md-icon",[e._v("filter")])],1),e._v(" "),"main"!=t.type?n("md-menu-item",{on:{click:function(t){e.close(o)}}},[n("span",[e._v("Close")]),e._v(" "),n("md-icon",[e._v("close")])],1):e._e()],1)],1)],1)],1),e._v(" "),t.panel?n("md-card-expand-content",[n("md-card-content",[n("joy",{attrs:{config:t.panel}})],1)],1):e._e()],1),e._v(" "),n("md-card-content",{staticClass:"plugin-iframe-container"},["empty"==t.type?n("md-empty-state",{attrs:{"md-icon":"hourglass_empty","md-label":"IMJOY.IO","md-description":""}}):e._e(),e._v(" "),"imjoy/files"==t.type?n("div",[n("md-list",e._l(t.data.files,function(t){return n("md-list-item",{key:t.name,on:{click:function(e){t.loaders&&Object.keys(t.loaders).length>0&&t.loaders[Object.keys(t.loaders)[0]]()}}},[n("md-icon",[e._v("insert_drive_file")]),e._v(" "),n("span",{staticClass:"md-list-item-text"},[e._v(e._s(t.name))]),e._v(" "),t.loaders&&Object.keys(t.loaders).length>0?n("md-menu",{attrs:{"md-size":"big","md-direction":"bottom-end"}},[n("md-button",{staticClass:"md-icon-button",attrs:{"md-menu-trigger":""}},[n("md-icon",[e._v("more_horiz")])],1),e._v(" "),n("md-menu-content",e._l(t.loaders,function(t,o){return n("md-menu-item",{key:o,on:{click:function(e){t()}}},[n("span",[e._v(e._s(o))]),e._v(" "),n("md-icon",[e._v("play_arrow")])],1)}))],1):e._e()],1)}))],1):"imjoy/image"==t.type?n("div",[n("img",{attrs:{src:t.data.image}})]):"imjoy/images"==t.type?n("div",e._l(t.data.images,function(e){return n("img",{attrs:{src:e}})})):"imjoy/panel"==t.type?n("div",[n("joy",{attrs:{config:t.config}})],1):"imjoy/generic"==t.type?n("div",{staticClass:"generic-plugin-window"},[n("md-list",[n("md-list-item",{on:{click:function(n){e.printObject(t.type,t.data)}}},[n("span",{staticClass:"md-list-item-text"},[e._v(e._s(e.dataSummary(t)))]),e._v(" "),n("md-tooltip",[e._v("click to print the data in your console.")])],1),e._v(" "),e._l(t.data,function(o,i){return t.data&&!t.data.length||t.data.length&&t.data.length>0&&i<=20?n("md-list-item",{key:i,on:{click:function(t){e.printObject(i,o)}}},[n("md-icon",[e._v("insert_drive_file")]),e._v(" "),n("span",{staticClass:"md-list-item-text"},[e._v(e._s(i))])],1):e._e()}),e._v(" "),t.data&&t.data.length&&t.data.length>20?n("md-list-item",{on:{click:function(n){e.printObject(t.data)}}},[n("md-icon",[e._v("insert_drive_file")]),e._v(" "),n("span",{staticClass:"md-list-item-text"},[e._v("...")]),e._v(" "),n("md-tooltip",[e._v("click to print the data in your console.")])],1):e._e()],2)],1):"imjoy/plugin-editor"==t.type?n("plugin-editor",{attrs:{pluginId:t.data.id,window:t,editorId:"editor_"+t.data.id},model:{value:t.data.code,callback:function(n){e.$set(t.data,"code",n)},expression:"w.data.code"}}):n("div",{staticClass:"plugin-iframe"},[t.click2load?n("md-button",{staticClass:"iframe-load-button",on:{click:function(e){t.click2load=!1,t.renderWindow(t)}}},[e._v("Click to load the window")]):e._e(),e._v(" "),n("div",{staticClass:"plugin-iframe",attrs:{id:t.iframe_container}})],1)],1)],1)],1)})),e._v(" "),n("div",{staticClass:"md-layout md-gutter md-alignment-center-center"},[e.windows&&0!=e.windows.length?e._e():n("md-empty-state",{attrs:{"md-icon":"static/img/anna-palm-icon-circle-animation.svg","md-label":"IMJOY.IO","md-description":""}})],1)],1)},staticRenderFns:[]};var ze=n("VU/8")(Be,Fe,!1,function(e){n("kn8I")},"data-v-dda0bede",null).exports,Je=this,Ve={name:"joy",props:{show:{type:Boolean,default:function(){return!0}},config:{type:Object,default:function(){return{}}}},data:function(){return{joy:null,isRunning:!1,router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){setTimeout(this.setupJoy,500)},watch:{config:function(e,t){Je.setupJoy&&Je.setupJoy()}},methods:{editSource:function(){this.$emit("edit",this.config)},setupJoy:function(e){!e&&this.joy&&(this.config.data=this.joy.top.data),this.$refs.editor.innerHTML="";var t={container:this.$refs.editor,init:this.config.ui||"",data:this.config.data||ge.a.loadFromURL(),modules:this.config.modules||["instructions","math"],onexecute:this.config.onexecute};for(var n in this.config)this.config.hasOwnProperty(n)&&n.endsWith("onupdate")&&"function"==typeof this.config[n]&&(t[n]=this.config[n]);console.log("setting up joy ",this.config);try{this.joy=new ge.a(t)}catch(e){t.data="",this.joy=new ge.a(t)}this.config.joy=this.joy},runJoy:function(){this.$emit("run",this.joy)},stopJoy:function(){this.$emit("stop")}}},qe={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"joy"},[t("div",{directives:[{name:"show",rawName:"v-show",value:this.show,expression:"show"}],staticClass:"joy-container"},[t("div",{ref:"editor",staticClass:"joy-editor"})])])},staticRenderFns:[]};var He=n("VU/8")(Ve,qe,!1,function(e){n("qlO1")},null,null).exports,Xe={name:"plugin-list",props:{configUrl:{type:String,default:null},workspace:{type:String,default:"default"},title:{type:String,default:null},center:{type:Boolean,default:!0},plugins:{type:Array,default:function(){return null}}},data:function(){return{editorCode:"",editorPlugin:null,editorOptions:{},showEditor:!1,containerWidth:500,uri_root:null,plugin_dir:null,manifest:null,available_plugins:[],showRemoveConfirmation:!1,_plugin2_remove:null,db:null,router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){var e=this;this.containerWidth=this.$refs.container.offsetWidth,this.store.event_bus.$on("resize",this.updateSize),this.db=new PouchDB(this.workspace+"_workspace",{revs_limit:2,auto_compaction:!0}),this.plugins?(this.available_plugins=this.plugins,this.updatePluginList()):this.configUrl&&x.a.get(this.configUrl).then(function(t){t&&t.data&&t.data.plugins&&(e.manifest=t.data,e.available_plugins=e.manifest.plugins,e.plugin_dir=e.manifest.uri_root,e.uri_root=location.protocol+"//"+location.host,e.plugin_dir.startsWith("http")||(e.plugin_dir=e.uri_root+e.plugin_dir,console.log(e.plugin_dir)),e.updatePluginList())})},beforeDestroy:function(){this.store.event_bus.$off("resize",this.updateSize)},methods:{updateSize:function(){this.containerWidth=this.$refs.container.offsetWidth},updatePluginList:function(){for(var e=this,t=function(t){var n=e.available_plugins[t];n.uri=n.uri||n.name+".html",n.uri.startsWith("http")||(n.uri="/"+n.uri),n.uri=e.plugin_dir+n.uri,n._id=n._id||n.name.replace(/ /g,"_"),e.db.get(n._id).then(function(t){n.installed=!0,e.$forceUpdate(),console.log(n)}).catch(function(e){console.log(n.name,e)})},n=0;n<this.available_plugins.length;n++)t(n)},edit:function(e){var t=this;this.db.get(e._id).then(function(n){t.editorCode=n.code,t.editorOptions={mode:"ace/mode/html",selectionStyle:"text"},t.editorPlugin=e,t.showEditor=!0,t.$forceUpdate()}).catch(function(t){console.log("error occured when editing ",e.name,t)})},saveCode:function(){var e=this;this.editorPlugin.code=this.editorCode,this.db.get(this.editorPlugin._id).then(function(t){return e.editorPlugin._id=e.editorPlugin.name.replace(/ /g,"_"),e.editorPlugin._rev=t._rev,e.db.put(e.editorPlugin)}).then(function(t){e.api.show("changes has been saved.")}).catch(function(t){console.error(t),e.api.show("something went wrong during saving.")})},remove:function(e){var t=this;this.db.get(e._id).then(function(e){return t.db.remove(e)}).then(function(n){console.log("plugin has been removed"),t.api.show("the plugin has been removed."),e.installed=!1,t.$forceUpdate()}).catch(function(t){console.log("error occured when removing ",e.name,t)})},updateAll:function(){var e=!0,t=!1,n=void 0;try{for(var o,i=h()(this.available_plugins);!(e=(o=i.next()).done);e=!0){var a=o.value;a.installed&&this.install(a)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}},install:function(e){var t=this;x.a.get(e.uri).then(function(n){if(n&&n.data&&""!=n.data){if(e.code=n.data,e._id=e.name.replace(/ /g,"_"),e.dependencies)for(var o=function(n){var o=t.available_plugins.filter(function(t){return t.name==e.dependencies[n]});o.length<=0?alert(e.name+" plugin depends on "+e.dependencies[n]+", but it can not be found in the repository."):(console.log("installing dependency ",o[0]),o[0].installed||t.install(o[0]))},i=0;i<e.dependencies.length;i++)o(i);var a=function(){t.db.put(e,{force:!0}).then(function(n){console.log("Successfully installed!"),e.installed=!0,t.$forceUpdate(),t.api.show(e.name+" has been sucessfully installed.")}).catch(function(e){t.api.show("failed to install the plugin."),console.error(e)})};t.db.get(e._id).then(function(e){return t.db.remove(e)}).then(function(e){a()}).catch(function(e){a()})}else alert("failed to get plugin code from "+e.uri)})}}},Ge={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"container",staticClass:"plugin-list"},[e.title?n("md-subheader",[e._v(e._s(e.title)+"\n    "),e.available_plugins?n("md-button",{staticClass:"md-button md-primary",on:{click:function(t){e.updateAll()}}},[n("md-icon",[e._v("update")]),e._v("Update All")],1):e._e()],1):e._e(),e._v(" "),e._l(e.available_plugins,function(t,o){return e.containerWidth<=500?n("md-card",{key:o},[n("md-card-header",[e._v("\n      "+e._s(t.createdAt)+"\n      "),n("h2",[e._v(e._s(t.name))]),e._v(" "),n("p",[e._v(e._s(t.description))]),e._v(" "),e._l(t.tags,function(t){return n("md-chip",{key:t},[e._v(e._s(t))])})],2),e._v(" "),n("md-card-content",[t.installed?e._e():n("md-button",{staticClass:"md-button md-primary",on:{click:function(n){e.install(t)}}},[n("md-icon",[e._v("cloud_download")]),e._v("Install")],1),e._v(" "),t.installed?n("md-button",{staticClass:"md-button md-primary",on:{click:function(n){e.install(t)}}},[n("md-icon",[e._v("update")]),e._v("Update")],1):e._e(),e._v(" "),t.installed?n("md-button",{staticClass:"md-accent",on:{click:function(n){e._plugin2_remove=t,e.showRemoveConfirmation=!0}}},[n("md-icon",[e._v("delete_forever")]),e._v("Delete")],1):e._e(),e._v(" "),t.installed?n("md-button",{staticClass:"md-button md-primary",on:{click:function(n){e.edit(t)}}},[n("md-icon",[e._v("edit")]),e._v("Edit")],1):e._e()],1)],1):e._e()}),e._v(" "),e.containerWidth>500?n("grid",{staticClass:"grid-container",attrs:{center:e.center,draggable:!1,sortable:!0,items:e.available_plugins,"cell-width":380,"cell-height":280,"grid-width":e.containerWidth},scopedSlots:e._u([{key:"cell",fn:function(t){return[n("md-card",[n("md-card-header",[e._v("\n         "+e._s(t.item.createdAt)+"\n         "),n("h2",[e._v(e._s(t.item.name))]),e._v(" "),n("p",[e._v(e._s(t.item.description))]),e._v(" "),e._l(t.item.tags,function(t){return n("md-chip",{key:t},[e._v(e._s(t))])})],2),e._v(" "),n("md-card-content",[t.item.installed?e._e():n("md-button",{staticClass:"md-button md-primary",on:{click:function(n){e.install(t.item)}}},[n("md-icon",[e._v("cloud_download")]),e._v("Install")],1),e._v(" "),t.item.installed?n("md-button",{staticClass:"md-button md-primary",on:{click:function(n){e.install(t.item)}}},[n("md-icon",[e._v("update")]),e._v("Update")],1):e._e(),e._v(" "),t.item.installed?n("md-button",{staticClass:"md-accent",on:{click:function(n){e._plugin2_remove=t.item,e.showRemoveConfirmation=!0}}},[n("md-icon",[e._v("delete_forever")]),e._v("Delete")],1):e._e(),e._v(" "),t.item.installed?n("md-button",{staticClass:"md-button md-primary",on:{click:function(n){e.edit(t.item)}}},[n("md-icon",[e._v("edit")]),e._v("Edit")],1):e._e()],1)],1)]}}])}):e._e(),e._v(" "),n("br"),e._v(" "),n("md-dialog-confirm",{attrs:{"md-active":e.showRemoveConfirmation,"md-title":"Removing Plugin","md-content":"Do you really want to <strong>delete</strong> this plugin","md-confirm-text":"Yes","md-cancel-text":"Cancel"},on:{"update:mdActive":function(t){e.showRemoveConfirmation=t},"md-cancel":function(t){e.showRemoveConfirmation=!1},"md-confirm":function(t){e.remove(e._plugin2_remove),e.showRemoveConfirmation=!1}}}),e._v(" "),n("md-dialog",{staticClass:"editor-dialog",attrs:{"md-active":e.showEditor},on:{"update:mdActive":function(t){e.showEditor=t}}},[n("md-dialog-content",[n("plugin-editor",{staticClass:"code-editor",attrs:{title:"Plugin Editor",options:e.editorOptions},model:{value:e.editorCode,callback:function(t){e.editorCode=t},expression:"editorCode"}})],1),e._v(" "),n("md-dialog-actions",[n("md-button",{staticClass:"md-primary",on:{click:function(t){e.saveCode(),e.showEditor=!1}}},[e._v("Save")]),e._v(" "),n("md-button",{staticClass:"md-primary",on:{click:function(t){e.showEditor=!1}}},[e._v("Cancel")])],1)],1)],2)},staticRenderFns:[]};var Ye,Ke=n("VU/8")(Xe,Ge,!1,function(e){n("jBsF")},"data-v-0e47ff3c",null).exports,Qe=n("bOdI"),Ze=n.n(Qe),et=n("lDdF"),tt=this,nt=(Ye={name:"joy",props:["value","options","title","pluginId","window"],data:function(){return{router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},watch:{options:function(){tt.editor.setOptions(tt.options)}},mounted:function(){var e=this,t="editor_"+this.pluginId;ace.require("ace/tooltip").Tooltip.prototype.setPosition=function(e,n){var o=document.getElementById(t).getBoundingClientRect();n-=o.top-64,e-=o.left,this.getElement().style.left=e+"px",this.getElement().style.top=n+"px"},this.editor=ace.edit(t),ace.config.set("basePath","/static/ace"),this.editor.setOptions({wrap:!1,maxLines:1/0}),this.editor.setTheme("ace/theme/chrome"),this.editor.session.setMode("ace/mode/html"),this.editor.session.on("change",function(t){e.$emit("input",e.editor.getValue())}),this.editor.setValue(this.value)}},Ze()(Ye,"watch",{}),Ze()(Ye,"methods",{save:function(){this.window.save({pluginId:this.pluginId,code:this.editor.getValue()})},reload:function(){var e=this;this.editor.resize(),this.window.reload({pluginId:this.pluginId,type:this.window.plugin.type,name:this.window.plugin.name,code:this.editor.getValue(),plugin:this.window.plugin}).then(function(t){e.window.plugin=t,e.window.name=t.name})},saveAs:function(){var e=this.window.plugin&&this.window.plugin.name?this.window.plugin.name+"_"+O()+".imjoy.html":"plugin_"+O()+".imjoy.html",t=new Blob([this.editor.getValue()],{type:"text/plain;charset=utf-8"});Object(et.saveAs)(t,e)}}),Ye),ot={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"plugin-editor"},[n("md-toolbar",{staticClass:"md-dense editor-toolbar",attrs:{"md-elevation":"1"}},[n("md-button",{staticClass:"md-icon-button",on:{click:function(t){e.reload()}}},[n("md-icon",[e._v("autorenew")]),e._v(" "),n("md-tooltip",[e._v("Update the plugin")])],1),e._v(" "),n("md-button",{staticClass:"md-icon-button",on:{click:function(t){e.save()}}},[n("md-icon",[e._v("save")]),e._v(" "),n("md-tooltip",[e._v("Save the plugin")])],1),e._v(" "),n("md-button",{staticClass:"md-icon-button",on:{click:function(t){e.saveAs()}}},[n("md-icon",[e._v("cloud_download")]),e._v(" "),n("md-tooltip",[e._v("Export the plugin")])],1)],1),e._v(" "),n("md-content",{staticClass:"editor"},[n("div",{attrs:{id:"editor_"+e.pluginId}})])],1)},staticRenderFns:[]};var it=n("VU/8")(nt,ot,!1,function(e){n("Z3ac")},"data-v-e196e01c",null).exports,at={debug:!0,event_bus:new o.default,api:{}},rt={name:"app",data:function(){return{show_navbar:!0,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){var e=this;window.location.href.indexOf("navbar=0")>=0&&(this.show_navbar=!1),this.$nextTick(function(){e.store.api.show=e.show;var t=function(t){e.store.windowHeight=window.innerHeight,e.store.windowWidth=window.innerWidth,e.store.event_bus.$emit("resize",{height:e.store.windowHeight,width:e.store.windowWidth})};t(),document.addEventListener("orientationchange",window.onresize=t)})},methods:{show:function(e,t){this.snackbar_info=e,this.snackbar_duration=t||3e3,this.showSnackbar=!0}},watch:{}},st={render:function(){var e=this.$createElement,t=this._self._c||e;return t("md-app",{attrs:{id:"app","md-waterfall":"","md-mode":"fixed"}},[t("md-app-content",[t("router-view")],1)],1)},staticRenderFns:[]};var lt=n("VU/8")(rt,st,!1,function(e){n("NaKT")},null,null).exports,ct=n("3OQN"),dt=n.n(ct),ut=n("DnPr"),pt=n.n(ut);o.default.config.productionTip=!1,o.default.use(Ie.a),o.default.use(pt.a),o.default.component("vue-slider",We.a),o.default.component("navbar",Re),o.default.component("faq",De),o.default.component("imjoy",ye),o.default.component("main-footer",Ne),o.default.component("about",Ce),o.default.component("whiteboard",ze),o.default.component("joy",He),o.default.component("plugin-list",Ke),o.default.component("plugin-editor",it),o.default.component("grid-layout",dt.a.GridLayout),o.default.component("grid-item",dt.a.GridItem);o.default.filter("truncate",function(e,t,n){n=n||"...";var o=document.createElement("div");o.innerHTML=e;var i=o.textContent;return i.length>t?i.slice(0,t)+n:i}),new o.default({el:"#app",router:Se,data:{store:at,router:Se},template:"<App/>",components:{App:lt}})},NaKT:function(e,t){},UpWs:function(e,t){},Z3ac:function(e,t){},giDI:function(e,t){},h7Em:function(e,t){},jBsF:function(e,t){},kn8I:function(e,t){},qlO1:function(e,t){},vTna:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return f});var o=n("C4MV"),i=n.n(o),a=n("mvHQ"),r=n.n(a),s=n("Xxa5"),l=n.n(s),c=n("exGp"),d=n.n(c),u=n("pFYg"),p=n.n(u),m=n("//Fk"),h=n.n(m);function f(e){var t=this==window?{}:this;if(e.modules)for(var n=0;n<e.modules.length;n++)f.loadModule(e.modules[n]);return f.Op.call(t,e),f.initReferences(t),void 0==t.previewOps&&(t.previewOps=!0),void 0==t.previewNumbers&&(t.previewNumbers=!0),t.activePreview=null,t.canPreview=function(e){return e=e.charAt(0).toUpperCase()+e.slice(1),t["preview"+e]&&!t.activePreview},t.createWidget(),t.container&&("string"==typeof t.container&&(t.container=document.body.querySelector(t.container)),t.container.appendChild(t.dom)),f.ui.init(t),f.modal.init(t),t.update=function(){var e={op:t,data:{}};if(t.children.forEach(function(t){var n=t.dataID;if(n){var o=t.get();e.data[n]=o}}),t.children.forEach(function(t){t.id&&(e[t.id]=t)}),t.onupdate&&"function"==typeof t.onupdate){var n=t.onupdate({data:e.data});n instanceof h.a&&n.then(function(e){e&&e.init&&(t.init=e.init,t.children=[],f.initializeWithString(t,t.init),t.createWidget(),t.container&&(t.container.innerHTML="",t.container.appendChild(t.dom)))}).catch(function(){console.error("failed to run onupdate function in "+t.id)})}},t.update(),t}f.Op=function(e,t,n){var o=this;if(o._class_="Op",o.options=e,o.parent=t,o.top=o.parent?o.parent.top:o,o.type=e.type,o.type){var i=f.getTemplateByType(o.type);g(o,i)}if(g(o,o.options),t&&"object"==p()(t.onupdate)&&(o.onupdate=t.onupdate[o.id]),o.children=[],o.addChild=function(e,t){return"object"==p()(o.onupdate)&&(e.onupdate=o.onupdate[e.id]),"Op"!=e._class_&&(e=new f.Op(e,o,t)),o.children.push(e),e.id&&(o[e.id]=e),e},o.removeChild=function(e){w(o.children,e),e.kill()},o.update=function(){if(o.onupdate&&"function"==typeof o.onupdate){var e=o.onupdate({data:o.data});e instanceof h.a&&e.then(function(e){try{if(e&&e.init){var t=o.dom;o.children=[],f.initializeWithString(o,e.init),o.createWidget(),o.parent&&o.parent.dom&&o.parent.dom.replaceChild(o.dom,t)}}catch(e){console.error(e)}}).catch(function(){console.error("failed to run onupdate function in "+o.id)})}o.parent&&o.parent.update()},o.onkill=o.onkill||function(){},o.kill=function(){for(o.dom&&o.dom.parentNode&&o.dom.parentNode.removeChild(o.dom),unwatch(o.data,c);o.children.length>0;)o.removeChild(o.children[0]);o.onkill(o)},void 0===o.placeholder&&(o.placeholder={}),"function"==typeof o.placeholder&&(o.placeholder=o.placeholder()),("object"!==p()(o.placeholder)||Array.isArray(o.placeholder))&&(o.placeholder={value:v(o.placeholder)}),o.placeholder.type||(o.placeholder.type=o.type),o.data=o.data||n,!o.data){t=o.parent;var a=o.dataID;t&&a?(t.data[a]||(t.data[a]=v(o.placeholder)),o.data=t.data[a]):o.data=v(o.placeholder)}o.getData=function(e){return o.data[e]},o.setData=function(e,t,n){s=!0,void 0===t?delete o.data[e]:o.data[e]=t,setTimeout(function(){s=!1},1),n||o.update()},o.switchData=function(e){unwatch(o.data,c),o.data=e,watch(o.data,c),o.onDataChange&&o.onDataChange(e)};var r,s=!1,c=function(e,t,n,i){s||o.onDataChange&&o.onDataChange()};watch(o.data,c),o.dom=null,o.initWidget=o.initWidget||function(){o.dom=document.createElement("span"),o.dom.innerHTML="[todo: '"+o.type+"' widget]"},o.createWidget=function(){return o.initWidget(o),o.dom},o.previewData=null,o.onexecute=o.onexecute||function(){console.log("no execute function found.")},o.execute=(r=d()(l.a.mark(function e(t,n){var i;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n?v(n):o.previewData?v(o.previewData):v(o.data),o.children.forEach(function(e){var n=e.dataID;if(n){var o=e.get(t);i[n]=o}}),e.next=4,o.onexecute({op:o,target:t,data:i});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)}),o.get_config=function(e){var t;return e=e||{},t=o.previewData?v(o.previewData):v(o.data),o.children.forEach(function(n){var o=n.dataID;if(o&&e){var i=n.get(e);t[o]=i}}),t},o.onget=o.onget||function(e){return e.data},o.get=function(e){var t=o.previewData?o.previewData:o.data;return t=v(t),o.onget({op:o,target:e,data:t})},o.init&&("string"==typeof o.init&&f.initializeWithString(o,o.init),"function"==typeof o.init&&o.init(o))},f.templates=[],f.add=function(e){var t=f.templates.filter(function(t){return void 0!==t.type&&void 0!==e.type&&t.type==e.type});if(t.length<=0)f.templates.push(e);else{for(var n=0;n<t.length;n++)w(f.templates,t[n]);f.templates.push(e)}},f.remove=function(e){var t=f.templates.filter(function(t){if(t.type==e)return!0});if(t.length>0)for(var n=0;n<t.length;n++)w(f.templates,t[n])},f.reset=function(){f.templates=[]},f.getTemplateByType=function(e){var t=f.templates.find(function(t){return t.type==e});if(!t)throw Error("No op template of type '"+e+"'!");return t},f.getTemplatesByTag=function(e){return f.templates.filter(function(t){return t.tags&&t.tags.indexOf(e)>=0})},f.modify=function(){var e,t,n;2==arguments.length?(e=arguments[0],n=arguments[1]):(e=arguments[0],t=arguments[1],n=arguments[2]);var o={},i=f.getTemplateByType(e);g(o,i);var a=n(i);g(o,a),t?i.type=t:w(f.templates,i),f.add(o)},f.initializeWithString=function(e,t){for(var n=[],o=t,i=-1,a=-1,r=0,s=0;s<o.length;s++){var l=o[s];if(0==r&&"{"==l&&(i=s),"{"==l&&r++,"}"==l&&r--,0==r&&"}"==l){a=s+1;var c=o.slice(i,a);c=(c=c.replace(/(\w+)\:/g,"'$1':")).replace(/\'/g,'"'),(c=JSON.parse(c)).dataID=c.dataID||c.id,n.push(c),o=o.substr(0,i)+"<span id='widget_"+c.id+"'></span>"+o.substr(a),s=0,i=-1,a=-1,r=0}}n.forEach(function(t){e.addChild(t)}),e.createWidget=function(){return e.dom=document.createElement("span"),e.dom.innerHTML=o,e.children.forEach(function(t){t.createWidget();var n="#widget_"+t.id,o=e.dom.querySelector(n);e.dom.replaceChild(t.dom,o)}),e.dom}},f.modules={},f.module=function(e,t){f.modules[e]=t},f.loadModule=function(e){var t=f.modules[e];if(!t)throw Error("There's no module called '"+e+"'!");t()},f.initReferences=function(e){var t=e.top.data;for(var n in t._references||(t._references={}),t._references){t._references[n].connected=0}},f.createReference=function(e,t,n){var o=e.top.data,i={id:C(o._references),tags:x(t),data:n,connected:0};return o._references[i.id]=i,i},f.getReferenceById=function(e,t){return e.top.data._references[t]},f.getReferencesByTag=function(e,t){var n=e.top.data,o=[];for(var i in n._references){var a=n._references[i];a.tags.indexOf(t)>=0&&o.push(a)}return o},f.connectReference=function(e,t){f.getReferenceById(e,t).connected++},f.disconnectReference=function(e,t){var n=f.getReferenceById(e,t);n.connected--,0==n.connected&&f.deleteReference(e,t)},f.deleteReference=function(e,t){var n=e.top.data;n._references[t];delete n._references[t]},f.saveToURL=function(e){var t=r()(e),n=W.compressToEncodedURIComponent(t);return window.location.origin+window.location.pathname+"?data="+n},f.loadFromURL=function(){var e=j("data"),t=W.decompressFromEncodedURIComponent(e);return t?JSON.parse(t):null},Math.TAU=2*Math.PI;var v=function(e){return JSON.parse(r()(e))},g=function(e,t){for(var n in t){var o=t[n];e[n]=o}},w=function(e,t){var n=e.indexOf(t);return!(n<0)&&(e.splice(n,1),!0)},_=function(e){e.addEventListener("paste",function(e){if(e.preventDefault(),e.clipboardData&&e.clipboardData.getData){var t=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)}else if(window.clipboardData&&window.clipboardData.getData){!function(e){var t,n;window.getSelection?(t=window.getSelection()).getRangeAt&&t.rangeCount&&((n=t.getRangeAt(0)).deleteContents(),n.insertNode(document.createTextNode(e))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=e)}(t=window.clipboardData.getData("Text"))}})},y=function(e,t){var n=document.createRange();n.selectNodeContents(e),t&&n.collapse(!1);var o=window.getSelection();o.removeAllRanges();try{o.addRange(n)}catch(e){}},b=function(){window.getSelection().removeAllRanges()},k=function(e){""==e.innerText&&(e.innerHTML="&nbsp;",y(e)),e.innerHTML.search("<br>")>=0&&(e.innerHTML=e.innerHTML.replace(/(\<br\>)+/g,"&nbsp;"),y(e,!0))},C=function(e){var t,n=0;do{t="id"+n,n++}while(e[t]);return t},x=function(e){return Array.isArray(e)?e:[e]},j=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};function P(e,t,n){var o,i,a,r,s,l,c,d;switch(1===arguments.length&&(t=e.s,n=e.v,e=e.h),l=n*(1-t),c=n*(1-(s=6*(e/=360)-(r=Math.floor(6*e)))*t),d=n*(1-(1-s)*t),r%6){case 0:o=n,i=d,a=l;break;case 1:o=c,i=n,a=l;break;case 2:o=l,i=n,a=d;break;case 3:o=l,i=c,a=n;break;case 4:o=d,i=l,a=n;break;case 5:o=n,i=l,a=c}return[Math.round(255*o),Math.round(255*i),Math.round(255*a)]}function E(e,t,n){1===arguments.length&&(t=e[1],n=e[2],e=e[0]);var o=P(e,t,n);return"rgb("+o[0]+","+o[1]+","+o[2]+")"}var D,S=0,O=[[0,.6,1],[30,.8,1],[210,.8,1],[260,.7,1],[310,.6,1]];D=function(){function e(){b=null;for(var e=0;e<y.length;e++)y[e]();y.length=0}var t={noMore:!1,useDirtyCheck:!1},n=[],o=[],a=[],r=!1;try{r=i.a&&Object.defineProperty({},"x",{})}catch(t){}var s=function(e){return e&&"[object Function]"=={}.toString.call(e)},l=function(e){return"[object Array]"===Object.prototype.toString.call(e)},c=function(e){return"[object Object]"==={}.toString.apply(e)},d=function(e,t){var n=[],o=[];if("string"!=typeof e&&"string"!=typeof t){if(l(e)&&t)for(var i=0;i<e.length;i++)void 0===t[i]&&n.push(i);else for(var i in e)e.hasOwnProperty(i)&&t&&void 0===t[i]&&n.push(i);if(l(t)&&e)for(var a=0;a<t.length;a++)void 0===e[a]&&o.push(a);else for(var a in t)t.hasOwnProperty(a)&&e&&void 0===e[a]&&o.push(a)}return{added:n,removed:o}},u=function(e){if(null==e||"object"!=(void 0===e?"undefined":p()(e)))return e;var t=e.constructor();for(var n in e)t[n]=e[n];return t},m=function(e,t,n){try{i()(e,t,{enumerable:!1,configurable:!0,writable:!1,value:n})}catch(o){e[t]=n}},h=function(e,t,n){o[o.length]={prop:t,object:e,orig:u(e[t]),callback:n}},f=function e(t,n,o,i){if("string"!=typeof t&&(t instanceof Object||l(t))){if(l(t)){if(P(t,"__watchall__",n,o),void 0===o||o>0)for(var a=0;a<t.length;a++)e(t[a],n,o,i)}else{var s=[];for(a in t)"$val"==a||!r&&"watchers"===a||Object.prototype.hasOwnProperty.call(t,a)&&s.push(a);v(t,s,n,o,i)}i&&N(t,"$$watchlengthsubjectroot",n,o)}},v=function(e,t,n,o,i){if("string"!=typeof e&&(e instanceof Object||l(e)))for(var a=0;a<t.length;a++){var r=t[a];g(e,r,n,o,i)}},g=function(e,t,n,o,i){"string"!=typeof e&&(e instanceof Object||l(e))&&(s(e[t])||(null!=e[t]&&(void 0===o||o>0)&&f(e[t],n,void 0!==o?o-1:o),P(e,t,n,o),i&&(void 0===o||o>0)&&N(e,t,n,o)))},w=function(e,t){if(!(e instanceof String)&&(e instanceof Object||l(e)))if(l(e)){for(var n=["__watchall__"],o=0;o<e.length;o++)n.push(o);_(e,n,t)}else{!function e(n){var o=[];for(var i in n)n.hasOwnProperty(i)&&(n[i]instanceof Object?e(n[i]):o.push(i));_(n,o,t)}(e)}},_=function(e,t,n){for(var o in t)t.hasOwnProperty(o)&&I(e,t[o],n)},y=[],b=null,k=function(){return b||(b=setTimeout(e)),b},C=function(e){null==b&&k(),y[y.length]=e},x=function(e,t,n,o){var i=null,a=-1,r=l(e);f(e,function(n,o,s,l){var c=k();if(a!==c&&(a=c,(i={type:"update"}).value=e,i.splices=null,C(function(){t.call(this,i),i=null})),r&&e===this&&null!==i){if("pop"===o||"shift"===o)s=[],l=[l];else if("push"===o||"unshift"===o)s=[s],l=[];else if("splice"!==o)return;i.splices||(i.splices=[]),i.splices[i.splices.length]={index:n,deleteCount:l?l.length:0,addedCount:s?s.length:0,added:s,deleted:l}}},1==n?void 0:0,o)},j=function(e,t,n,o,i){e&&t&&(g(e,t,function(e,t,a,r){var s={type:"update"};s.value=a,s.oldvalue=r,(o&&c(a)||l(a))&&x(a,n,o,i),n.call(this,s)},0),(o&&c(e[t])||l(e[t]))&&x(e[t],n,o,i))},P=function(e,n,o,a){var r=!1,s=l(e);e.watchers||(m(e,"watchers",{}),s&&O(e,function(t,o,i,r){if(T(e,t,o,i,r),0!==a&&i&&(c(i)||l(i))){var s,d,u,p,m=e.watchers[n];for((p=e.watchers.__watchall__)&&(m=m?m.concat(p):p),u=m?m.length:0,s=0;s<u;s++)if("splice"!==o)f(i,m[s],void 0===a?a:a-1);else for(d=0;d<i.length;d++)f(i[d],m[s],void 0===a?a:a-1)}})),e.watchers[n]||(e.watchers[n]=[],s||(r=!0));for(var d=0;d<e.watchers[n].length;d++)if(e.watchers[n][d]===o)return;if(e.watchers[n].push(o),r){var u=e[n],p=function(o,i){var r=u;if(u=o,0!==a&&e[n]&&(c(e[n])||l(e[n]))&&!e[n].watchers){var s,d=e.watchers[n].length;for(s=0;s<d;s++)f(e[n],e.watchers[n][s],void 0===a?a:a-1)}return $(e,n)?void W(e,n):void(t.noMore||r!==o&&(i?T(e,n,"set",o,r):E(e,n,"set",o,r),t.noMore=!1))};t.useDirtyCheck?h(e,n,p):function(e,t,n,o){try{Object.observe(e,function(e){e.forEach(function(e){e.name===t&&o(e.object[e.name])})})}catch(a){try{i()(e,t,{get:n,set:function(e){o.call(this,e,!0)},enumerable:!0,configurable:!0})}catch(i){try{Object.prototype.__defineGetter__.call(e,t,n),Object.prototype.__defineSetter__.call(e,t,function(e){o.call(this,e,!0)})}catch(n){h(e,t,o)}}}}(e,n,function(){return u},p)}},E=function e(t,n,o,i,a){if(void 0!==n){var r,s,l=t.watchers[n];(s=t.watchers.__watchall__)&&(l=l?l.concat(s):s),r=l?l.length:0;for(var c=0;c<r;c++)l[c].call(t,n,o,i,a)}else for(var n in t)t.hasOwnProperty(n)&&e(t,n,o,i,a)},D=["pop","push","reverse","shift","sort","slice","unshift","splice"],S=function(e,t,n,o){m(e,n,function(){var i,a,r,s,l=0;if("splice"===n){var c=arguments[0],d=c+arguments[1];for(r=e.slice(c,d),a=[],i=2;i<arguments.length;i++)a[i-2]=arguments[i];l=c}else a=arguments.length>0?arguments[0]:void 0;return s=t.apply(e,arguments),"slice"!==n&&("pop"===n?(r=s,l=e.length):"push"===n?l=e.length-1:"shift"===n?r=s:"unshift"!==n&&void 0===a&&(a=s),o.call(e,l,n,a,r)),s})},O=function(e,t){if(s(t)&&e&&!(e instanceof String)&&l(e))for(var n,o=D.length;o--;)S(e,e[n=D[o]],n,t)},I=function(e,t,n){if(t){if(e.watchers[t])if(void 0===n)delete e.watchers[t];else for(var o=0;o<e.watchers[t].length;o++){e.watchers[t][o]==n&&e.watchers[t].splice(o,1)}}else delete e.watchers;M(e,t,n),U(e,t)},$=function(e,t){return e.watchers&&(e.watchers.__wjs_suspend__||e.watchers["__wjs_suspend__"+t])},W=function(e,t){C(function(){delete e.watchers.__wjs_suspend__,delete e.watchers["__wjs_suspend__"+t]})},A=null,T=function(e,t,n,o,i){a[a.length]={obj:e,prop:t,mode:n,newval:o,oldval:i},null===A&&(A=setTimeout(R))},R=function(){var e=null;A=null;for(var t=0;t<a.length;t++)e=a[t],E(e.obj,e.prop,e.mode,e.newval,e.oldval);e&&(a=[],e=null)},L=function(e,t){var n,o=!0;if(e!==t)if(c(e)){for(n in e)if((r||"watchers"!==n)&&e[n]!==t[n]){o=!1;break}}else o=!1;return o},N=function(e,t,o,i){var a;a=u("$$watchlengthsubjectroot"===t?e:e[t]),n.push({obj:e,prop:t,actual:a,watcher:o,level:i})},M=function(e,t,o){for(var i=0;i<n.length;i++){var a=n[i];a.obj==e&&(t&&a.prop!=t||o&&a.watcher!=o||n.splice(i--,1))}},U=function(e,t){for(var n=0;n<o.length;n++){var i=o[n],a=i.object.watchers;i.object==e&&(!t||i.prop==t)&&a&&(!t||!a[t]||0==a[t].length)&&o.splice(n--,1)}};return setInterval(function(){for(var e=0;e<n.length;e++){var t=n[e];if("$$watchlengthsubjectroot"===t.prop)((i=d(t.obj,t.actual)).added.length||i.removed.length)&&(i.added.length&&v(t.obj,i.added,t.watcher,t.level-1,!0),t.watcher.call(t.obj,"root","differentattr",i,t.actual)),t.actual=u(t.obj);else{var i;if((i=d(t.obj[t.prop],t.actual)).added.length||i.removed.length){if(i.added.length)for(var a=0;a<t.obj.watchers[t.prop].length;a++)v(t.obj[t.prop],i.added,t.obj.watchers[t.prop][a],t.level-1,!0);E(t.obj,t.prop,"differentattr",i,t.actual)}t.actual=u(t.obj[t.prop])}}var r,s;if(o.length>0)for(e=0;e<o.length;e++)s=(r=o[e]).object[r.prop],L(r.orig,s)||(r.orig=u(s),r.callback(s))},50),t.watch=function(){s(arguments[1])?f.apply(this,arguments):l(arguments[1])?v.apply(this,arguments):g.apply(this,arguments)},t.unwatch=function(){s(arguments[1])?w.apply(this,arguments):l(arguments[1])?_.apply(this,arguments):I.apply(this,arguments)},t.callWatchers=E,t.suspend=function(e,t){if(e.watchers){var n="__wjs_suspend__"+(void 0!==t?t:"");e.watchers[n]=!0}},t.onChange=function(){(s(arguments[2])?j:x).apply(this,arguments)},t},"function"==typeof define&&n("nErl")?define(D):(window.WatchJS=D(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers);var I,$,W=function(){function e(e,t){if(!i[e]){i[e]={};for(var n=0;n<e.length;n++)i[e][e.charAt(n)]=n}return i[e][t]}var t=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={},a={compressToBase64:function(e){if(null==e)return"";var t=a._compress(e,6,function(e){return n.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:a._decompress(t.length,32,function(o){return e(n,t.charAt(o))})},compressToUTF16:function(e){return null==e?"":a._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:a._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=a.compress(e),n=new Uint8Array(2*t.length),o=0,i=t.length;i>o;o++){var r=t.charCodeAt(o);n[2*o]=r>>>8,n[2*o+1]=r%256}return n},decompressFromUint8Array:function(e){if(null===e||void 0===e)return a.decompress(e);for(var n=new Array(e.length/2),o=0,i=n.length;i>o;o++)n[o]=256*e[2*o]+e[2*o+1];var r=[];return n.forEach(function(e){r.push(t(e))}),a.decompress(r.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":a._compress(e,6,function(e){return o.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),a._decompress(t.length,32,function(n){return e(o,t.charAt(n))}))},compress:function(e){return a._compress(e,16,function(e){return t(e)})},_compress:function(e,t,n){if(null==e)return"";var o,i,a,r={},s={},l="",c="",d="",u=2,p=3,m=2,h=[],f=0,v=0;for(a=0;a<e.length;a+=1)if(l=e.charAt(a),Object.prototype.hasOwnProperty.call(r,l)||(r[l]=p++,s[l]=!0),c=d+l,Object.prototype.hasOwnProperty.call(r,c))d=c;else{if(Object.prototype.hasOwnProperty.call(s,d)){if(d.charCodeAt(0)<256){for(o=0;m>o;o++)f<<=1,v==t-1?(v=0,h.push(n(f)),f=0):v++;for(i=d.charCodeAt(0),o=0;8>o;o++)f=f<<1|1&i,v==t-1?(v=0,h.push(n(f)),f=0):v++,i>>=1}else{for(i=1,o=0;m>o;o++)f=f<<1|i,v==t-1?(v=0,h.push(n(f)),f=0):v++,i=0;for(i=d.charCodeAt(0),o=0;16>o;o++)f=f<<1|1&i,v==t-1?(v=0,h.push(n(f)),f=0):v++,i>>=1}0==--u&&(u=Math.pow(2,m),m++),delete s[d]}else for(i=r[d],o=0;m>o;o++)f=f<<1|1&i,v==t-1?(v=0,h.push(n(f)),f=0):v++,i>>=1;0==--u&&(u=Math.pow(2,m),m++),r[c]=p++,d=String(l)}if(""!==d){if(Object.prototype.hasOwnProperty.call(s,d)){if(d.charCodeAt(0)<256){for(o=0;m>o;o++)f<<=1,v==t-1?(v=0,h.push(n(f)),f=0):v++;for(i=d.charCodeAt(0),o=0;8>o;o++)f=f<<1|1&i,v==t-1?(v=0,h.push(n(f)),f=0):v++,i>>=1}else{for(i=1,o=0;m>o;o++)f=f<<1|i,v==t-1?(v=0,h.push(n(f)),f=0):v++,i=0;for(i=d.charCodeAt(0),o=0;16>o;o++)f=f<<1|1&i,v==t-1?(v=0,h.push(n(f)),f=0):v++,i>>=1}0==--u&&(u=Math.pow(2,m),m++),delete s[d]}else for(i=r[d],o=0;m>o;o++)f=f<<1|1&i,v==t-1?(v=0,h.push(n(f)),f=0):v++,i>>=1;0==--u&&(u=Math.pow(2,m),m++)}for(i=2,o=0;m>o;o++)f=f<<1|1&i,v==t-1?(v=0,h.push(n(f)),f=0):v++,i>>=1;for(;;){if(f<<=1,v==t-1){h.push(n(f));break}v++}return h.join("")},decompress:function(e){return null==e?"":""==e?null:a._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(e,n,o){var i,a,r,s,l,c,d,u=[],p=4,m=4,h=3,f="",v=[],g={val:o(0),position:n,index:1};for(i=0;3>i;i+=1)u[i]=i;for(r=0,l=Math.pow(2,2),c=1;c!=l;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),r|=(s>0?1:0)*c,c<<=1;switch(r){case 0:for(r=0,l=Math.pow(2,8),c=1;c!=l;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),r|=(s>0?1:0)*c,c<<=1;d=t(r);break;case 1:for(r=0,l=Math.pow(2,16),c=1;c!=l;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),r|=(s>0?1:0)*c,c<<=1;d=t(r);break;case 2:return""}for(u[3]=d,a=d,v.push(d);;){if(g.index>e)return"";for(r=0,l=Math.pow(2,h),c=1;c!=l;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),r|=(s>0?1:0)*c,c<<=1;switch(d=r){case 0:for(r=0,l=Math.pow(2,8),c=1;c!=l;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),r|=(s>0?1:0)*c,c<<=1;u[m++]=t(r),d=m-1,p--;break;case 1:for(r=0,l=Math.pow(2,16),c=1;c!=l;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),r|=(s>0?1:0)*c,c<<=1;u[m++]=t(r),d=m-1,p--;break;case 2:return v.join("")}if(0==p&&(p=Math.pow(2,h),h++),u[d])f=u[d];else{if(d!==m)return null;f=a+a.charAt(0)}v.push(f),u[m++]=a+f.charAt(0),a=f,0==--p&&(p=Math.pow(2,h),h++)}}};return a}();"function"==typeof define&&n("nErl")&&define(function(){return W}),I={},f.ui=I,I.init=function(e){e.dom.classList.add("joy-master"),e.container.addEventListener("wheel",function(t){var n=t.deltaY;return e.container.scrollTop+=n,!1}),document.body.addEventListener("keydown",function(e){if(8===e.keyCode){var t=!0,n=e.srcElement||e.target;if(!n.getAttribute("readonly")&&!n.getAttribute("disabled"))if(n.isContentEditable)t=!1;else if("INPUT"==n.tagName.toUpperCase()){var o=n.getAttribute("type");o&&(o=o.toLowerCase()),["text","password","file","search","email","number","date","color","datetime","datetime-local","month","range","search","tel","time","url","week"].indexOf(o)>-1&&(t=!1)}else"TEXTAREA"==n.tagName.toUpperCase()&&(t=!1);if(t)return e.preventDefault(),!1}})},I.Button=function(e){var t=this,n=document.createElement("div");n.className="joy-button",t.dom=n,e.label=e.label||"",t.label=document.createElement("span"),n.appendChild(t.label),t.setLabel=function(e){t.label.innerHTML=e},t.setLabel(e.label),n.onclick=function(){e.onclick()},t.styles=e.styles||[];for(var o=0;o<t.styles.length;o++)n.classList.add(t.styles[o])},I.ChooserButton=function(e){var t=this;t.value=e.value,t.options=e.options,t.onchange=e.onchange,t.value||(t.value=t.options[0].value),I.Button.call(t,{label:void 0===e.staticLabel?"":e.staticLabel,onclick:function(){f.modal.Chooser({source:t.dom,options:t.options,onchange:function(e){t.value=e,n(),t.onchange(e)},position:e.position})},styles:e.styles});var n=function(){if(void 0===e.staticLabel){var n=t.options.find(function(e){return e.value==t.value}).label;t.setLabel(n)}};n()},I.Scrubber=function(e){var t=this,n=e.min,o=e.max;t.value=e.value;var i=document.createElement("div");i.className="joy-scrubber",t.dom=i,t.setLabel=function(e){i.innerHTML=e.toFixed(t.sigfigs)};var a,r,s=function(n){n=parseFloat(n.toFixed(t.sigfigs)),e.onchange(n)},l=!1,c=!1,d=0,u=function(n){l=!0,a=n.clientX,r=t.value,d=0,e.onstart&&e.onstart()},p=function(e){if(l){c=!0;var n=Math.pow(.1,t.sigfigs);n=parseFloat(n.toPrecision(1));var o=e.clientX-a;a=e.clientX;var i=Math.abs(o/10);i<1&&(i=1),i>3&&(i=3),d+=o*i;var u=Math.floor(d/2),p=r+u*n;p=m(p),t.value!=p&&(t.value=p,t.setLabel(p),s(p))}},m=function(e){return void 0!==n&&e<n&&(e=n),void 0!==o&&e>o&&(e=o),e},h=function(){l=!1,e.onstop&&e.onstop(),setTimeout(function(){c=!1},1)};i.addEventListener("mousedown",u),window.addEventListener("mousemove",p),window.addEventListener("mouseup",h),t.kill=function(){i.removeEventListener("mousedown",u),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",h)};var f,v=!1;i.onblur=function(){v&&(v=!1,i.contentEditable=!1,b(),w(i.innerText),t.value=g(),t.setLabel(t.value),s(t.value),e.onstop&&e.onstop())},_(i),(f=i).addEventListener("keypress",function(e){13===e.which&&(e.preventDefault(),f.blur())}),i.onclick=function(){c||(v=!0,i.contentEditable=!0,i.spellcheck=!1,y(i),e.onstart&&e.onstart())},i.oninput=function(e){if(v){var t=/[^0-9.\-]/g;i.innerText.match(t)&&(i.innerText=i.innerText.replace(t,"")),k(i),s(g())}};var g=function(){var e=parseFloat(i.innerText);return isNaN(e)&&(e=0),e=m(e)};t.sigfigs=0;var w=function(e){var n,o=(e=e.toString()).search(/\./);n=o>=0?e.length-1-o:0,t.sigfigs=n};w(t.value),t.setLabel(t.value)},I.String=function(e){var t=document.createElement("div");t.className="joy-string",this.dom=t;var n=document.createElement("span");n.contentEditable=!0,n.spellcheck=!1;var o=document.createElement("span"),i=document.createElement("span");o.innerHTML=e.prefix||"",i.innerHTML=e.suffix||"",t.appendChild(o),t.appendChild(n),t.appendChild(i),n.oninput=function(t){k(n);var o=n.innerText;e.onchange(o)},n.onfocus=function(){y(n)},n.onblur=function(){b()},_(n),n.onkeypress=function(e){return 13!=e.which||(n.blur(),!1)},this.setString=function(e){n.innerText=e,k(n)},this.setColor=function(e){e=function(e){return Array.isArray(e)&&(e=E(e[0],e[1],e[2])),e}(e),t.style.color=e,t.style.borderColor=e},e.color&&this.setColor(e.color),this.styles=e.styles||[];for(var a=0;a<this.styles.length;a++)t.classList.add(this.styles[a]);this.setString(e.value)},I.TextBox=function(e){var t,n=this;e.multiline?t=document.createElement("textarea"):(t=document.createElement("input")).type="text",e.placeholder&&(t.placeholder=e.placeholder),t.spellcheck=!1,t.className="joy-textbox",n.dom=t;var o=n.dom;e.readonly?(t.setAttribute("readonly",1),t.addEventListener("click",function(){n.select()})):t.oninput=function(n){e.onchange(t.value)},e.width&&(t.style.width="number"==typeof e.width?e.width+"px":e.width),n.getValue=function(){return t.value},n.setValue=function(e){t.value=e},n.select=function(){t.select()},n.styles=e.styles||[];for(var i=0;i<n.styles.length;i++)o.classList.add(n.styles[i]);e.value&&n.setValue(e.value),e.multiline&&(o.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"},!1),setTimeout(function(){o.setAttribute("style","height:"+o.scrollHeight+"px; overflow-y:hidden;")},1))},$={},f.modal=$,$.init=function(e){$.dom=document.createElement("div"),$.dom.id="joy-modal",document.body.appendChild($.dom),$.bg=document.createElement("div"),$.bg.id="joy-bg",$.bg.onclick=function(){$.currentUI.kill()},$.dom.appendChild($.bg),$.box=document.createElement("div"),$.box.id="joy-box",$.box.className="arrow_box",$.dom.appendChild($.box),$.dom.addEventListener("wheel",function(e){return"auto"==$.box.style.overflow||(e.preventDefault(),!1)})},$.show=function(e){$.dom.style.display="block",$.currentUI=e,$.box.appendChild(e.dom);var t=e.config.position||"below",n=$.box.getBoundingClientRect(),o=e.config.source.getBoundingClientRect(),i=$.bg.getBoundingClientRect();switch("below"==t&&(r=o.top+o.height+20)+n.height>document.body.clientHeight&&(t="left"),$.box.setAttribute("position",t),t){case"below":var a=o.left+o.width/2,r=o.top+o.height+20;a-=n.width/2;break;case"left":a=o.left-20,r=o.top+o.height/2,a-=n.width,r-=n.height/2}a<0&&(a=1),r+n.height>i.height&&(r=i.height-n.height-1),$.box.style.left=a+"px",$.box.style.top=r+"px",$.currentUI.config.onopen&&$.currentUI.config.onopen()},$.hide=function(){!function(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild)}($.box),$.dom.style.display="none",$.currentUI.config.onclose&&$.currentUI.config.onclose()},$.Chooser=function(e){var t={};t.config=e;var n=document.createElement("div");n.className="joy-modal-chooser",t.dom=n;var o=document.createElement("div");n.appendChild(o),t.options=[],t.categories={};var i=function(e){var n=document.createElement("div");o.appendChild(n),t.categories[e]=n};t.populate=function(){for(var n=0;n<e.options.length;n++)(r=(o=e.options[n]).category)?t.categories[r]||i(r):t.categories._placeholder_||i("_placeholder_");for(n=0;n<e.options.length;n++){var o=e.options[n],a=document.createElement("div");a.innerHTML=o.label,o.color&&(a.style.color=o.color);var r=o.category||"_placeholder_";t.categories[r].appendChild(a),function(e){a.onclick=function(n){t.onchange(e.value),n.stopPropagation()}}(o)}},t.populate(),t.onchange=function(n){t.kill(),e.onchange(n)},t.kill=function(){$.hide()},$.show(t)},$.Color=function(e){var t={};t.config=e;var n=document.createElement("div");n.className="joy-modal-color",t.dom=n,e.value=e.value||[0,1,1],t.h=e.value[0],t.s=e.value[1],t.v=e.value[2],t.dom.style.width="195px",t.dom.style.height="170px";var o=document.createElement("canvas");o.id="joy-color-wheel";var i=o.getContext("2d");o.width=300,o.height=300,o.style.width=o.width/2+"px",o.style.height=o.height/2+"px",n.appendChild(o),o.style.top="10px",o.style.left="10px";var a=function(){var e=i;e.clearRect(0,0,e.canvas.width,e.canvas.height);for(var n=o.width,a=o.height,r=e.createImageData(n,a),s=r.data,l=n/2,c=a/2,d=n/2,u=d+2,p=0;p<n;p++)for(var m=0;m<a;m++){var h=p-l,f=m-c,v=Math.sqrt(h*h+f*f);if(v<u){v>=d&&(v=d);var g=Math.atan2(f,h),w=P(g=360*(g/Math.TAU+.5),v/=d,t.v),_=4*(p+m*n);s[_]=w[0],s[_+1]=w[1],s[_+2]=w[2],s[_+3]=255}}e.putImageData(r,0,0),e.save(),e.globalCompositeOperation="destination-in",e.beginPath(),e.fillStyle="#fff",e.arc(l,c,d,0,Math.TAU),e.fill(),e.restore()};a();var r=document.createElement("canvas");r.id="joy-color-value";var s=r.getContext("2d");r.width=30,r.height=300,r.style.width=r.width/2+"px",r.style.height=r.height/2+"px",n.appendChild(r),r.style.top="10px",r.style.right="10px";var l=function(){var e=s;e.clearRect(0,0,e.canvas.width,e.canvas.height);for(var n=r.width,o=r.height,i=e.createImageData(n,o),a=i.data,l=0;l<n;l++)for(var c=0;c<o;c++){var d=P(t.h,t.s,1-c/o),u=4*(l+c*n);a[u]=d[0],a[u+1]=d[1],a[u+2]=d[2],a[u+3]=255}e.putImageData(i,0,0)};l();var c=document.createElement("canvas");c.id="joy-color-picker";var d=c.getContext("2d");c.width=390,c.height=340,c.style.width=c.width/2+"px",c.style.height=c.height/2+"px",n.appendChild(c);var u,p=function(){var e,n,i=d;i.clearRect(0,0,i.canvas.width,i.canvas.height),i.fillStyle=E(t.h,t.s,t.v),i.strokeStyle="#fff",i.lineWidth=2;var a=20+o.width/2,s=20+o.height/2,l=t.h*(Math.TAU/360),c=t.s*(o.width/2);e=a-Math.cos(l)*c,n=s-Math.sin(l)*c,i.beginPath(),i.arc(e,n,15,0,Math.TAU),i.fill(),i.stroke(),e=20+o.width+20+r.width/2,n=20+r.height*(1-t.v),i.beginPath(),i.arc(e,n,15,0,Math.TAU),i.fill(),i.stroke()};p();var m=!1,h=function(e){if(e.target==c){var t=2*e.offsetX,n=2*e.offsetY;"hs"==u?f(t-=20,n-=20):(t-=20+o.width+20,v(t,n-=20)),y()}},f=function(e,n){var i=o.width/2,a=e-i,r=n-i,s=Math.atan2(r,a),c=Math.sqrt(a*a+r*r);(s=360*(s/Math.TAU+.5))<0&&(s=0),s>360&&(s=360),(c/=i)<0&&(c=0),c>1&&(c=1),t.h=s,t.s=c,l(),p()},v=function(e,n){t.v=1-n/r.height,t.v<0&&(t.v=0),t.v>1&&(t.v=1),a(),p()},g=function(e){m=!0,u=2*e.offsetX<20+o.width+10?"hs":"v",h(e)},w=function(e){m&&h(e)},_=function(){m=!1};c.addEventListener("mousedown",g),window.addEventListener("mousemove",w),window.addEventListener("mouseup",_);var y=function(){var n=[t.h,t.s,t.v];n[0]=parseFloat(n[0].toFixed(0)),n[1]=parseFloat(n[1].toFixed(2)),n[2]=parseFloat(n[2].toFixed(2)),e.onchange(n)};t.kill=function(){n.removeEventListener("mousedown",g),window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",_),$.hide()},$.show(t)},f.add({type:"number",tags:["ui"],initWidget:function(e){var t=e.options,n=new f.ui.Scrubber({min:t.min,max:t.max,step:t.step,value:e.getData("value"),onstart:function(){e.top.activePreview=e},onstop:function(){e.top.activePreview=null},onchange:function(t){e.setData("value",t)}});e.dom=n.dom;var o=null;e.dom.onmouseenter=function(){if(e.top.canPreview("numbers")){e.previewData=v(e.data);var t=Math.abs(.05*e.data.value);0==t&&(t=1);var n=0;o=setInterval(function(){if(!e.top.canPreview("numbers"))return i();n+=Math.TAU/30/.25,e.previewData.value=e.data.value+Math.sin(n)*t,e.update(),n>Math.TAU&&i()},1e3/30)}};var i=function(){o&&clearInterval(o),e.previewData=null,e.update()};e.dom.onmouseleave=i},onget:function(e){return e.data.value},placeholder:{value:3}}),f.add({type:"button",tags:["ui"],initWidget:function(e){var t=document.createElement("div");t.className="joy-save",e.dom=t,e.saveButton=new f.ui.Button({label:e.options.label||"--",onclick:function(){e.update()}}),t.appendChild(e.saveButton.dom)}}),f.add({type:"color",tags:["ui"],initWidget:function(e){var t=new f.ui.Button({label:"&nbsp;",onclick:function(){f.modal.Color({source:e.dom,value:e.getData("value"),onchange:function(t){e.setData("value",t),n()},onopen:function(){e.top.activePreview=e},onclose:function(){e.top.activePreview=null}})},styles:["joy-color"]});e.dom=t.dom;var n=function(){var n=e.getData("value");t.dom.style.background=E(n)};n();var o,i,a=null;e.dom.onmouseenter=function(){e.top.canPreview("numbers")&&(e.data.value[2],e.previewData=v(e.data),i=0,o=2/30*2,a=setInterval(function(){if(!e.top.canPreview("numbers"))return r();var t=e.previewData.value;t[2]+=o,t[2]>1&&(t[2]=1,o*=-1),t[2]<0&&(t[2]=0,o*=-1),e.update(),(i+=2/30)>=1&&r()},1e3/30))};var r=function(){a&&clearInterval(a),e.previewData=null,e.update()};e.dom.onmouseleave=r},onget:function(e){return E(e.data.value)},placeholder:function(){return[Math.floor(360*Math.random()),.8,1]}}),f.add({type:"choose",tags:["ui"],initWidget:function(e){for(var t=e.data,n=e.options,o=0;o<n.length;o++){var i=n[o];void 0!==i.label&&void 0!==i.value||(n[o]={label:i.toString(),value:i})}var a=new f.ui.ChooserButton({value:t.value,options:n,onchange:function(n){t.value=n,e.update()},styles:e.styles});e.dom=a.dom},onget:function(e){return e.data.value}}),f.add({type:"string",tags:["ui"],initWidget:function(e){var t=e.options;e.stringUI=new f.ui.String({prefix:t.prefix,suffix:t.suffix,color:t.color,value:e.getData("value"),onchange:function(t){e.setData("value",t)}}),e.dom=e.stringUI.dom,e.onDataChange=function(){var t=e.getData("value");e.stringUI.setString(t)}},onget:function(e){return e.data.value},placeholder:"???"}),f.add({type:"save",tags:["ui"],initWidget:function(e){var t=document.createElement("div");t.className="joy-save",e.dom=t,e.saveButton=new f.ui.Button({label:"save",onclick:function(){var t=f.saveToURL(e.top.data);e.url.setValue(t),e.url.select();t.length;e.info.innerHTML="P.S: you can shorten your link with <a href='http://tinyurl.com/' target='_blank'>TinyURL</a>!"}}),t.appendChild(e.saveButton.dom),e.url=new f.ui.TextBox({readonly:!0}),t.appendChild(e.url.dom),e.info=document.createElement("div"),e.info.id="joy-save-info",t.appendChild(e.info)}}),f.add({type:"ops",tags:["ui"],init:function(e){void 0!==e.resetVariables&&(e.data.resetVariables=e.resetVariables)},initWidget:function(e){var t=e.data.ops,n=document.createElement("div");n.className="joy-ops",e.dom=n;var o=document.createElement("list");o.id="joy-list",n.appendChild(o);var i=[{label:"Add op above",value:"op_above"},{label:"Add op below",value:"op_below"},{label:"Delete",value:"delete"}],a=function(n){var a=new f.ui.ChooserButton({position:"below",staticLabel:r(n),options:i,onchange:function(i){!function(n,i){var a=0;if("op_above"==i&&(a=-1),"op_below"==i&&(a=1),0!=a){var r=e.entries.indexOf(n);a>0&&(r+=1),f.modal.Chooser({position:"below",source:n.bullet.dom,options:u,onchange:function(t){d(t,r),e.update(),s()}})}"delete"==i&&(w(e.entries,n),w(t,n.opData),e.removeChild(n.op),o.removeChild(n.dom),e.update(),s())}(n,i)},styles:["joy-bullet"]});return a.dom.id="joy-bullet",a},r=function(t){for(var n,o=e.entries.indexOf(t)+1,i=0,a=e.parent;a;)"ops"==a.type&&i++,a=a.parent;switch(i%3){case 0:n=o;break;case 1:n=function(e){for(var t=0,n=1;e>=n;)t++,e-=n,n*=26;for(var o="",i=0;i<t;i++)o="abcdefghijklmnopqrstuvwxyz".charAt(e%26)+o,e=Math.floor(e/26);return o}(o);break;case 2:n=function(e){if(!+e)return NaN;for(var t=String(+e).split(""),n=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"],o="",i=3;i--;)o=(n[+t.pop()+10*i]||"")+o;return(Array(+t.join("")+1).join("M")+o).toLowerCase()}(o)}return n},s=function(){for(var t=0;t<e.entries.length;t++){var n=e.entries[t],o=n.bullet,i=r(n);o.setLabel(i)}};e.entries=[];for(var l=function(t,i){var r={},s=document.createElement("div");void 0===i&&(i=e.entries.length),e.entries.splice(i,0,r),o.insertBefore(s,o.children[i]);var l=a(r),c=document.createElement("div");c.id="joy-bullet-container",s.appendChild(c),c.appendChild(l.dom);var d=e.addChild({type:t.type},t),u=d.createWidget();u.id="joy-widget",s.appendChild(u),r.dom=s,r.bullet=l,r.op=d,r.widget=u,r.opData=t;var p,m,h=function(t){var n=t.offsetY/l.dom.getBoundingClientRect().height;n<0&&(n=0),n>1&&(n=1),p._PREVIEW=n,e.update()};return c.onmouseenter=function(t){if(e.top.canPreview("ops")){e.top.activePreview=e,e.previewData=v(e.data);var o=e.entries.indexOf(r);p=e.previewData.ops[o],e.previewData.ops.splice(o+1,0,{STOP:!0}),h(t),m=document.createElement("style"),document.head.appendChild(m),m.sheet.insertRule(".joy-ops.joy-previewing > #joy-list > div:nth-child(n+"+(o+2)+") { opacity:0.1; }"),m.sheet.insertRule(".joy-ops.joy-previewing > div.joy-bullet { opacity:0.1; }"),n.classList.add("joy-previewing")}},c.onmousemove=function(t){e.previewData&&h(t)},c.onmouseleave=function(){e.previewData&&(e.previewData=null,e.top.activePreview=null,e.update(),document.head.removeChild(m),n.classList.remove("joy-previewing"))},r},c=0;c<t.length;c++)l(t[c]);var d=function(e,n){var o={type:e};void 0===n?t.push(o):t.splice(n,0,o);l(o,n)},u=[];if(e.onlyOps)for(c=0;c<e.onlyOps.length;c++){var p=e.onlyOps[c],m=f.getTemplateByType(p),h=m.tags.filter(function(e){return"op"!=e})[0];u.push({label:m.name,value:p,category:h})}else{var g=f.getTemplatesByTag("op");for(c=0;c<g.length;c++){var _=g[c];h=_.tags.filter(function(e){return"op"!=e})[0];u.push({label:_.name,value:_.type,category:h})}}var y=new f.ui.ChooserButton({staticLabel:"+",options:u,onchange:function(t){d(t),e.update()},styles:["joy-bullet"]});n.appendChild(y.dom)},onexecute:function(){var e=d()(l.a.mark(function e(t){var n,o,i,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.target._variables||(t.target._variables={}),t.data.resetVariables&&(t.target._variables={}),n=0;case 3:if(!(n<t.data.ops.length)){e.next=30;break}if(!(o=t.data.ops[n]).STOP){e.next=7;break}return e.abrupt("return","STOP");case 7:return i=t.op.entries[n].op,e.next=10,i.execute(t.target,o);case 10:if(!(a=e.sent)||!a.target){e.next=15;break}t.target=a.target,e.next=27;break;case 15:if(!a||!a.error){e.next=20;break}return console.error("ops stopped with error: ",a),e.abrupt("return",a);case 20:if(!a||!a.stop){e.next=25;break}return console.log("ops interrupted at step ",n,a),e.abrupt("return",a);case 25:if("STOP"!=a){e.next=27;break}return e.abrupt("return",a);case 27:n++,e.next=3;break;case 30:return e.abrupt("return",t);case 31:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),placeholder:{ops:[],resetVariables:!0}}),f.module("instructions",function(){f.add({name:"Repeat the following...",type:"instructions/repeat",tags:["instructions","op"],init:"Repeat the following {id:'count', type:'number', min:1, placeholder:3} times: {id:'ops', type:'ops', resetVariables:false}",onexecute:function(){var e=d()(l.a.mark(function e(t){var n,o,i,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=1,void 0!==t.data._PREVIEW&&(n=t.data._PREVIEW),o=Math.floor(t.data.count*n),i=0;case 4:if(!(i<o)){e.next=27;break}return e.next=7,t.op.ops.execute(t.target);case 7:if(!(a=e.sent)||!a.target){e.next=12;break}t.target=a.target,e.next=24;break;case 12:if(!a.error){e.next=17;break}return console.error("op stopped with error: ",a),e.abrupt("return",a);case 17:if(!a.stop){e.next=22;break}return console.log("op interrupted at step ",i,a),e.abrupt("return",a);case 22:if("STOP"!=a){e.next=24;break}return e.abrupt("return",a);case 24:i++,e.next=4;break;case 27:return e.abrupt("return",t);case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}),f.add({name:"// Write a note",type:"instructions/comment",tags:["instructions","op"],initWidget:function(e){e.dom=document.createElement("div"),e.box=new f.ui.TextBox({multiline:!0,placeholder:"// your notes here",value:e.getData("value"),onchange:function(t){e.setData("value",t)},styles:["box"]}),e.dom.appendChild(e.box.dom)}})}),f.add({type:"variableName",tags:["ui"],init:function(e){var t=e.variableType;e._createNewReference=function(){var n,o,i={value:(o=0,f.getReferencesByTag(e,t).map(function(e){return e.data.value}).forEach(function(e){var t;"variable"==e&&(t=1);var n=e.match(/variable\s(\d+)/);n&&(t=parseInt(n[1])),o<t&&(o=t)}),0==o?"variable":"variable "+(o+1)),color:(n=O[S],S=(S+1)%O.length,n)},a=f.createReference(e,t,i);e.setData("refID",a.id,!0),f.connectReference(e,a.id)};var n=e.getData("refID");if(n)f.connectReference(e,n);else{var o=f.getReferencesByTag(e,t);if(e.startWithExisting&&o.length>0)n=o[o.length-1].id,e.setData("refID",n,!0),f.connectReference(e,n);else e._createNewReference()}e._switchReference=function(t){var n=e.getData("refID");f.disconnectReference(e,n),e.setData("refID",t),f.connectReference(e,t)}},initWidget:function(e){e.dom=document.createElement("span");var t=e.getData("refID"),n=f.getReferenceById(e,t).data,o=e.addChild({type:"string",prefix:"[",suffix:"]",color:n.color},n),i=o.createWidget();e.dom.appendChild(i);var a=o.onDataChange;o.onDataChange=function(){a();var e=o.getData("color");o.stringUI.setColor(e)};var r=e.variableType;e.noChooser||(e.dom.onclick=function(){var t=[],n=f.getReferencesByTag(e,r),i=e.getData("refID");n.forEach(function(e){if(e.id!=i){var n=e.data.color;n=E(n[0],n[1],n[2]),t.push({label:"["+e.data.value+"]",value:e.id,color:n})}}),t.push({category:"meta",label:"(+new)",value:"NEW"}),t.push({category:"meta",label:"(change color)",value:"CHANGE_COLOR"}),f.modal.Chooser({source:e.dom,options:t,onchange:function(t){if("CHANGE_COLOR"==t)f.modal.Color({source:e.dom,value:o.getData("color"),onchange:function(e){o.setData("color",e),o.stringUI.setColor(e)}});else{if("NEW"==t){var n=e.getData("refID");f.disconnectReference(e,n),e._createNewReference(),e.update()}else e._switchReference(t);var i=e.getData("refID"),a=f.getReferenceById(e,i);o.switchData(a.data)}}})})},onget:function(e){var t=e.data.refID;return f.getReferenceById(e.op,t).data.value},onkill:function(e){var t=e.getData("refID");f.disconnectReference(e,t)}}),f.module("math",function(){f.modify("number","number_raw",function(e){return{init:function(e){if(!e.noVariables){var t=e.getData("value");"number"==typeof t&&(e.setData("value",void 0,!0),e.setData("chain",[{type:"number_raw",min:e.min,max:e.max,step:e.step,value:t}],!0)),e._makeNewChainOp=function(t,n){var o,i=t.type;switch(i){case"number_raw":o=e.addChild({type:i,min:t.min,max:t.max,step:t.step},t);break;case"variableName":o=e.addChild({type:i,variableType:"number",noChooser:!0},t);break;case"choose":o=e.addChild({type:i,options:[{label:"+",value:"+"},{label:"-",value:"-"},{label:"&times;",value:"*"},{label:"&divide;",value:"/"}],styles:["joy-math"]},t)}var a=e.getData("chain");return void 0!==n?(e.chainOps.splice(n,0,o),a.splice(n,0,t)):(e.chainOps.push(o),a.push(t)),o},e.chainOps=[];var n=e.getData("chain"),o=v(n);n.splice(0,n.length);for(var i=0;i<o.length;i++)e._makeNewChainOp(o[i]);e._replaceChainOp=function(t,n){var o=e._deleteChainOp(t),i=e._makeNewChainOp(n,o);return e.update(),i},e._deleteChainOp=function(t){var n=e.chainOps.indexOf(t);return w(e.chainOps,t),e.removeChild(t),e.getData("chain").splice(n,1),n}}},initWidget:function(t){if(t.noVariables)e.initWidget(t);else{t.dom=document.createElement("span"),t.dom.className="joy-number";t._chainEntries=[],t._makeChainEntry=function(e,o){var i,a,r=document.createElement("span");if(e.createWidget(),r.appendChild(e.dom),"choose"!=e.type){var s,l=new f.ui.Button({onclick:function(){n(s)},styles:["joy-more"]});r.appendChild(l.dom)}if(void 0!==o)if(o<t.dom.childNodes.length){var c=t.dom.childNodes[o];t.dom.insertBefore(r,c)}else t.dom.appendChild(r);else t.dom.appendChild(r);"choose"!=e.type&&((i=e).dom.addEventListener("mousedown",function(){a=+new Date}),i.dom.addEventListener("mouseup",function(){+new Date-a<500&&function(e){var n=[];if("number_raw"!=e.type){var o=t.placeholder.value;"number"==typeof o&&n.push({label:o,value:{type:"number_raw",value:o}})}var i,a=f.getReferencesByTag(t,"number");"variableName"==e.type&&(i=e.getData("refID")),a.forEach(function(e){if(e.id!=i){var t=e.data.color;t=E(t[0],t[1],t[2]),n.push({label:"["+e.data.value+"]",value:{type:"variableName",refID:e.id},color:t})}}),n.length>0&&f.modal.Chooser({source:e.dom,options:n,onchange:function(n){var o=t._replaceChainOp(e,n);t._replaceChainEntry(e,o)}})}(i)})),s={widget:r,op:e},void 0!==o?t._chainEntries.splice(o,0,s):t._chainEntries.push(s)},t._deleteChainEntry=function(e){var n=t._chainEntries.find(function(t){return t.op==e}),o=t._chainEntries.indexOf(n),i=n.widget;return t.dom.removeChild(i),w(t._chainEntries,n),o},t._replaceChainEntry=function(e,n){var o=t._deleteChainEntry(e);t._makeChainEntry(n,o)};for(var n=function(e){var n=e.widget.innerText,o=[{label:n+" + 2",value:"+"},{label:n+" - 2",value:"-"},{label:n+" &times; 2",value:"*"},{label:n+" &divide; 2",value:"/"}],i=t._chainEntries.indexOf(e);if(t._chainEntries.length>1){var a,r;a=0==i?i+1:i-1;var s=t._chainEntries[a].widget.innerText;r=0==i?n+" "+s:s+" "+n;var l=[i,a].sort();o.push({category:"meta",label:"(delete "+r+")",value:l})}f.modal.Chooser({source:e.widget,options:o,onchange:function(n){if("string"==typeof n){var o=t._chainEntries.indexOf(e);o++;var i=t._makeNewChainOp({type:"choose",value:n},o);t._makeChainEntry(i,o),o++;var a=t._makeNewChainOp({type:"number_raw",value:2},o);t._makeChainEntry(a,o)}else for(var r=n,s=r.length-1;s>=0;s--){var l=r[s],c=t._chainEntries[l].op;t._deleteChainOp(c),t._deleteChainEntry(c)}t.update()}})},o=0;o<t.chainOps.length;o++){var i=t.chainOps[o];t._makeChainEntry(i)}}},onget:function(t){if(t.op.noVariables)return e.onget(t);for(var n=[],o=0;o<t.data.chain.length;o+=2){var i,a=t.op.chainOps[o];switch(a.type){case"number_raw":i=a.get(t.target);break;case"variableName":i=t.target._variables[a.get(t.target)]}if(o>0){var r=t.op.chainOps[o-1].get();n.push(r)}n.push(i)}for(o=1;o<n.length;o+=2){if("*"==(r=n[o])||"/"==r){var s=n[o-1],l=n[o+1];c="*"==r?s*l:s/l,n.splice(o-1,3,c),o-=2}}for(o=1;o<n.length;o+=2){if("+"==(r=n[o])||"-"==r){var c;s=n[o-1],l=n[o+1];c="+"==r?s+l:s-l,n.splice(o-1,3,c),o-=2}}return n[0]}}}),f.add({name:"Set [number]",type:"math/set",tags:["math","op"],init:"Set {id:'varname', type:'variableName', variableType:'number'} to {id:'value', type:'number'}",onexecute:function(e){e.target._variables[e.data.varname]=e.data.value}}),f.add({name:"Do math to [number]",type:"math/operation",tags:["math","op"],init:r()({id:"operation",type:"choose",placeholder:"+",options:[{label:"+ Increase",value:"+"},{label:"- Decrease",value:"-"},{label:"&times; Multiply",value:"*"},{label:"&divide; Divide",value:"/"}]})+" {id:'varname', type:'variableName', variableType:'number', startWithExisting:true} by {id:'value', type:'number'}",onexecute:function(e){var t=e.target._variables,n=e.data.varname;switch(void 0===t[n]&&(t[n]=0),e.data.operation){case"+":t[n]+=e.data.value;break;case"-":t[n]-=e.data.value;break;case"*":t[n]*=e.data.value;break;case"/":t[n]/=e.data.value}}}),f.add({name:"If [math] then...",type:"math/if",tags:["math","op"],init:"If {id:'value1', type:'number'} {id:'test', type:'choose', options:['<','','=','','>'], placeholder:'='} {id:'value2', type:'number'}, then: {id:'ops', type:'ops', resetVariables:false}",onexecute:function(e){var t,n=e.data.value1,o=e.data.value2;switch(e.data.test){case"<":t=n<o;break;case"":t=n<=o;break;case"=":t=n==o;break;case"":t=n>=o;break;case">":t=n>o}if(t){var i=e.op.ops.execute(e.target);if("STOP"==i)return i}}})}),f.module("random",function(){f.add({name:"With a X% chance...",type:"random/if",tags:["random","op"],init:"With a {id:'chance', type:'number', min:0, max:100, placeholder:50}% chance, do:{id:'ops', type:'ops', resetVariables:false}",onexecute:function(e){var t=e.data.chance/100;if(Math.random()<t){var n=e.op.ops.execute(e.target);if("STOP"==n)return n}}}),f.add({name:"Set random [number]",type:"random/set",tags:["random","op"],init:"Set {id:'varname', type:'variableName', variableType:'number'} to a random {id:'numtype', type:'choose', options:['number','integer'], placeholder:'number'} between {id:'min', type:'number', placeholder:1} and {id:'max', type:'number', placeholder:100}",onexecute:function(e){var t,n=e.target._variables,o=e.data.varname,i=e.data.min,a=e.data.max,r=Math.min(i,a),s=Math.max(i,a);t="integer"==e.data.numtype?r+Math.floor(Math.random()*(s-r+1)):r+Math.random()*(s-r),n[o]=t}})})}).call(t,n("f1Eh")(e))},"yYM+":function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.edb0579ce86f840f8523.js.map